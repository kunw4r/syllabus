/*! For license information please see 942.fd870ec1.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunksyllabus_client=self.webpackChunksyllabus_client||[]).push([[942],{1207(e,t,n){n.d(t,{TA:()=>Ee,w7:()=>be,Zb:()=>R,$t:()=>ae,I1:()=>Ce,Wq:()=>ie,pV:()=>Le,NC:()=>X,FE:()=>$,UQ:()=>Ve,eY:()=>ve,cM:()=>ye,Y2:()=>me,NJ:()=>L,_A:()=>P,f2:()=>Ae,Jp:()=>Ge,SR:()=>Be,mH:()=>Te,ks:()=>ze,Y8:()=>He,G9:()=>we,Nw:()=>Se,qv:()=>se,LF:()=>z,c0:()=>K,OA:()=>We,qx:()=>Ue,kr:()=>Z,a3:()=>re,j9:()=>oe,E$:()=>xe,ai:()=>Me,yN:()=>j,tT:()=>Q,BI:()=>G,h2:()=>_e,Ww:()=>ee,nK:()=>te,XT:()=>H,wM:()=>Y,e8:()=>fe,Nt:()=>F,eS:()=>W,lO:()=>Fe,Mx:()=>Je,q1:()=>pe,O4:()=>Ne,Ve:()=>he,aP:()=>qe,q8:()=>J,bm:()=>V,x5:()=>De,wO:()=>A,Qt:()=>Pe,AD:()=>ke,r7:()=>Oe});var o=n(2555),r=n(1144);const a="https://www.googleapis.com/books/v1";function i(e){return e?e.replace("http://","https://").replace(/&edge=curl/g,""):null}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{const n=await fetch("".concat(a,"/volumes?q=").concat(encodeURIComponent(e),"&maxResults=").concat(t,"&printType=books"));if(!n.ok)throw new Error(n.status);return((await n.json()).items||[]).map(c)}catch(n){return[]}}function c(e){var t,n,o,r,a;const s=e.volumeInfo||{},c=(null===(t=s.imageLinks)||void 0===t?void 0:t.thumbnail)||(null===(n=s.imageLinks)||void 0===n?void 0:n.smallThumbnail),l=[];if(c){const e=(d=c)?i(d).replace(/\bzoom=\d+\b/,"zoom=0"):null,t=i(c);e&&l.push(e),t&&t!==e&&l.push(t)}var d;return[null===(o=s.imageLinks)||void 0===o?void 0:o.extraLarge,null===(r=s.imageLinks)||void 0===r?void 0:r.large,null===(a=s.imageLinks)||void 0===a?void 0:a.medium].filter(Boolean).forEach(e=>{const t=i(e);t&&!l.includes(t)&&l.push(t)}),{key:e.id,title:s.title||"",author:(s.authors||[])[0]||"Unknown",description:s.description||"",poster_path:l[0]||null,cover_urls:l,authors:(s.authors||[]).map(e=>({name:e})),first_publish_date:s.publishedDate||"",subjects:s.categories||[],rating:s.averageRating||null,ratings_count:s.ratingsCount||0,want_to_read:0,currently_reading:0,already_read:0,edition_count:1,media_type:"book",google_id:e.id,industry_identifiers:s.industryIdentifiers||[],info_link:s.infoLink||"",preview_link:s.previewLink||""}}const l=[/study guide/i,/\bsummary\b/i,/\bsummaries\b/i,/analysis of/i,/condensed/i,/abridged/i,/cliffs? notes/i,/sparknotes/i,/bookrags/i,/bookcaps/i,/\bworkbook\b/i,/teacher'?s? guide/i,/reading guide/i,/\bquiz\b/i,/\bcollect(ed|ion)\b/i];async function d(e){if((e.cover_urls||[]).some(e=>e.includes("books.google.com")||e.includes("googleapis.com")))return e;let t=[];const n=(e.industry_identifiers||[]).map(e=>e.identifier).concat(e.isbn_13||[],e.isbn_10||[],e.isbn||[]);for(const o of n.slice(0,5))if(t=await s("isbn:".concat(o),1),t.length>0)break;if(0===t.length&&e.title){const n="intitle:".concat(e.title),o=e.author&&"Unknown"!==e.author?"".concat(n," inauthor:").concat(e.author):n,r=await s(o,8),a=r.filter(t=>{const n=t.title||"";if(l.some(e=>e.test(n)))return!1;const o=e.title.toLowerCase().split(/\s+/).filter(e=>e.length>3);if(o.length>0){const e=n.toLowerCase();if(o.filter(t=>e.includes(t)).length/o.length<.5)return!1}return!0}),i=a.length>0?a:r;i.sort((e,t)=>(t.ratings_count||0)-(e.ratings_count||0)),t=i.slice(0,1)}if(t.length>0){const n=t[0];n.cover_urls&&n.cover_urls.length>0&&(e.cover_urls=[...n.cover_urls,...e.cover_urls||[]],e.poster_path=n.poster_path||e.poster_path)}return e}const u="https://openlibrary.org",g=["4a3b711b","91f420c8"].filter(Boolean);let f=0;const m=new Set;function h(){for(let e=0;e<g.length;e++){const t=(f+e)%g.length;if(!m.has(t))return t}return m.clear(),0}async function v(e){for(let t=0;t<g.length;t++){const t=h(),n=g[t],o=await fetch("https://www.omdbapi.com/?".concat(e,"&apikey=").concat(n)),r=await o.json();if("Request limit reached!"!==r.Error)return r;m.add(t),f=(t+1)%g.length}return{Response:"False",Error:"Request limit reached!"}}const _=new Map,y=36e5;function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e5;const o=_.get(e);return o&&Date.now()-o.ts<n?Promise.resolve(o.data):t().then(t=>(_.set(e,{data:t,ts:Date.now()}),t))}const w="syllabus_scores",b="syllabus_omdb";let k=null;function N(){if(!k)try{k=JSON.parse(localStorage.getItem(w)||"{}")}catch(e){k={}}return k}function S(){try{localStorage.setItem(w,JSON.stringify(k))}catch(e){}}function j(e,t){var n;return null!==(n=N()["".concat(e,":").concat(t)])&&void 0!==n?n:null}function A(e,t,n){if(null==n||!t)return;N()["".concat(e,":").concat(t)]=n,S()}function R(e,t){const n=N();return e.forEach(e=>{const o="".concat(t,":").concat(e.id);null!=n[o]&&(e.unified_rating=n[o])}),e}let q=null;function I(){if(!q)try{q=JSON.parse(localStorage.getItem(b)||"{}");let t=!1;for(const e of Object.keys(q))null===q[e]&&(delete q[e],t=!0);if(t)try{localStorage.setItem(b,JSON.stringify(q))}catch(e){}}catch(t){q={}}return q}function C(e,t){const n=I();n[e]=t;try{localStorage.setItem(b,JSON.stringify(n))}catch(o){}}function M(e){var t;return null!==(t=I()[e])&&void 0!==t?t:void 0}const E="syllabus_static_db_ts";let x=!1;!async function(){if(!x){x=!0;try{const e=parseInt(localStorage.getItem(E)||"0");if(Date.now()-e<432e5)return}catch(e){}try{const e=await fetch("".concat("/syllabus","/data/scores.json"));if(!e.ok)return;const t=await e.json(),n=N();let o=0;for(const r of["movie","tv"]){const e=t[r];if(e)for(const[t,a]of Object.entries(e)){const e="".concat(r,":").concat(t);null==n[e]&&null!=a.s&&(n[e]=a.s,o++)}}o>0&&(S(),console.log("[Syllabus] Loaded ".concat(o," pre-built scores from static database"))),localStorage.setItem(E,String(Date.now()))}catch(t){console.warn("[Syllabus] Could not load static score DB:",t.message)}}}();const U="syllabus_charts";let O=null;function D(){if(!O)try{const t=JSON.parse(localStorage.getItem(U)||"{}");if(2!==t._v){O={_v:2};try{localStorage.setItem(U,JSON.stringify(O))}catch(e){}}else O=t}catch(t){O={_v:2}}return O}function L(e){const t=D()[e];return t?Date.now()-t.ts>864e5?null:t.items:null}function P(e){const t=D()[e];return t?Date.now()-t.ts:1/0}async function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(await fetch("".concat("https://api.themoviedb.org/3").concat(e,"?api_key=").concat("e78b9789ddab05e594a195dc997e9c3f").concat(t))).json()}function B(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return p("tmdb:".concat(e).concat(t),()=>T(e,t))}function F(){return B("/trending/movie/week").then(e=>e.results||[])}async function J(e){return(await T("/search/movie","&query=".concat(encodeURIComponent(e)))).results||[]}function z(e){return B("/movie/".concat(e),"&append_to_response=recommendations,credits,watch/providers,external_ids,videos")}function W(){return B("/trending/tv/week").then(e=>e.results||[])}async function V(e){return(await T("/search/tv","&query=".concat(encodeURIComponent(e)))).results||[]}function G(e){return B("/tv/".concat(e),"&append_to_response=recommendations,credits,watch/providers,external_ids,videos")}function H(){return B("/movie/top_rated").then(e=>e.results||[])}function Z(){return B("/movie/now_playing").then(e=>e.results||[])}function K(e){return B("/discover/movie","&with_genres=".concat(e,"&sort_by=popularity.desc&vote_count.gte=50")).then(e=>e.results||[])}function Y(){return B("/tv/top_rated").then(e=>e.results||[])}function Q(e){return B("/discover/tv","&with_genres=".concat(e,"&sort_by=popularity.desc&vote_count.gte=50")).then(e=>e.results||[])}function $(){return B("/discover/tv","&with_genres=16&with_original_language=ja&sort_by=popularity.desc&vote_count.gte=50").then(e=>e.results||[])}function X(){return B("/discover/tv","&with_genres=16&without_original_language=ja&sort_by=popularity.desc&vote_count.gte=20").then(e=>e.results||[])}function ee(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return p(e?"top100:movies:".concat(e):"top100:movies",async()=>{const t=e?"&with_genres=".concat(e):"",n=e?500:1e3,o=await Promise.all([1,2,3,4,5].map(e=>T("/discover/movie","&sort_by=vote_average.desc&vote_count.gte=".concat(n).concat(t,"&page=").concat(e)))),r=new Set;return o.flatMap(e=>e.results||[]).filter(e=>!r.has(e.id)&&(r.add(e.id),!0))})}function te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return p(e?"top100:tv:".concat(e):"top100:tv",async()=>{const t=e?"&with_genres=".concat(e):"",n=e?200:500,o=await Promise.all([1,2,3,4,5].map(e=>T("/discover/tv","&sort_by=vote_average.desc&vote_count.gte=".concat(n).concat(t,"&page=").concat(e)))),r=new Set;return o.flatMap(e=>e.results||[]).filter(e=>!r.has(e.id)&&(r.add(e.id),!0))})}function ne(e){if(!e||"False"===e.Response)return null;const t={imdb_id:e.imdbID};return(e.Ratings||[]).forEach(n=>{"Internet Movie Database"===n.Source?t.imdb={score:n.Value,votes:e.imdbVotes}:"Rotten Tomatoes"===n.Source?t.rt={score:n.Value}:"Metacritic"===n.Source&&(t.metacritic={score:n.Value})}),e.Director&&"N/A"!==e.Director&&(t.director=e.Director),e.Writer&&"N/A"!==e.Writer&&(t.writer=e.Writer),e.Awards&&"N/A"!==e.Awards&&(t.awards=e.Awards),e.BoxOffice&&"N/A"!==e.BoxOffice&&(t.boxOffice=e.BoxOffice),e.Rated&&"N/A"!==e.Rated&&(t.rated=e.Rated),e.Country&&"N/A"!==e.Country&&(t.country=e.Country),t}function oe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return Promise.resolve(null);const o="i:".concat(e),r=M(o);return void 0!==r?Promise.resolve(r):p("omdb:".concat(e),async()=>{try{const r=await v("i=".concat(e));if("Request limit reached!"===r.Error)throw new Error("OMDB_RATE_LIMIT");const a=ne(r);if(!a)return C(o,null),null;if(!a.rt&&t){const e="tv"===n?"series":"movie"===n?"movie":"";let o="t=".concat(encodeURIComponent(t));e&&(o+="&type=".concat(e));const r=await v(o);"False"!==r.Response&&(r.Ratings||[]).forEach(e=>{"Rotten Tomatoes"!==e.Source||a.rt||(a.rt={score:e.Value})})}return C(o,a),a}catch(r){if("OMDB_RATE_LIMIT"===(null===r||void 0===r?void 0:r.message))throw r;return null}})}function re(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"movie";if(!e)return Promise.resolve(null);const o="tv"===n?"series":"movie",r="t:".concat(e,":").concat(t||"",":").concat(o),a=M(r);return void 0!==a?Promise.resolve(a):p("omdb:t:".concat(e,":").concat(t||"",":").concat(o),async()=>{try{let n="t=".concat(encodeURIComponent(e),"&type=").concat(o);t&&(n+="&y=".concat(t));const a=await v(n);if("Request limit reached!"===a.Error)throw new Error("OMDB_RATE_LIMIT");const i=ne(a);return C(r,i),i}catch(n){if("OMDB_RATE_LIMIT"===(null===n||void 0===n?void 0:n.message))throw n;return null}})}function ae(e,t,n){var o;const r=[];if(null!==e&&void 0!==e&&null!==(o=e.imdb)&&void 0!==o&&o.score){const t=parseFloat(e.imdb.score);isNaN(t)||r.push(t)}var a;if(n)null!==t&&void 0!==t&&t.score&&r.push(t.score);else if(null!==e&&void 0!==e&&null!==(a=e.rt)&&void 0!==a&&a.score){const t=parseInt(e.rt.score);isNaN(t)||r.push(t/10)}return 0===r.length?null:parseFloat((r.reduce((e,t)=>e+t,0)/r.length).toFixed(1))}async function ie(e,t,n,r){const a=e.map(e=>(0,o.A)({},e)),i=N(),s=[];a.forEach(e=>{const n="".concat(t,":").concat(e.id);null!=i[n]?e.unified_rating=i[n]:s.push(e)});const c=s.length;let l=0;c>0&&r&&r({completed:0,total:c,phase:"enriching"});let d=!1;for(let o=0;o<s.length&&!d;o+=3){const e=s.slice(o,o+3);await Promise.all(e.map(async e=>{var n,o;if(d)return;const r=e.title||e.name,a=(e.release_date||e.first_air_date||"").slice(0,4),i="ja"===e.original_language&&((null===(n=e.genre_ids)||void 0===n?void 0:n.includes(16))||(null===(o=e.genres)||void 0===o?void 0:o.some(e=>16===e.id)));try{const n=await re(r,a,t);let o=null;if(i)try{o=await se(r)}catch(s){}e.unified_rating=ae(n,o,i),null!=e.unified_rating&&A(t,e.id,e.unified_rating)}catch(c){"OMDB_RATE_LIMIT"===(null===c||void 0===c?void 0:c.message)&&(d=!0)}})),l+=e.length,r&&r({completed:l,total:c,phase:"enriching"}),o+3<s.length&&await new Promise(e=>setTimeout(e,500))}if(a.sort((e,t)=>{var n,o,r,a,i,s;const c=null!==(n=null!==(o=null!==(r=e.unified_rating)&&void 0!==r?r:e.vote_average)&&void 0!==o?o:e.rating)&&void 0!==n?n:0;return(null!==(a=null!==(i=null!==(s=t.unified_rating)&&void 0!==s?s:t.vote_average)&&void 0!==i?i:t.rating)&&void 0!==a?a:0)-c}),n){!function(e,t){const n=D();n[e]={items:t,ts:Date.now()},n._v=2;try{localStorage.setItem(U,JSON.stringify(n))}catch(o){}}(n,a.map(e=>{let{id:t,title:n,name:o,poster_path:r,release_date:a,first_air_date:i,vote_average:s,unified_rating:c,genre_ids:l,genres:d,original_language:u,overview:g}=e;return{id:t,title:n,name:o,poster_path:r,release_date:a,first_air_date:i,vote_average:s,unified_rating:c,genre_ids:l,genres:d,original_language:u,overview:null===g||void 0===g?void 0:g.slice(0,200)}}))}return r&&r({completed:c,total:c,phase:"done"}),a}function se(e){return e?p("mal:".concat(e),async()=>{try{var t;const n=await fetch("https://api.jikan.moe/v4/anime?q=".concat(encodeURIComponent(e),"&limit=1")),o=null===(t=(await n.json()).data)||void 0===t?void 0:t[0];return o?{score:o.score,scored_by:o.scored_by,mal_id:o.mal_id,url:o.url}:null}catch(n){return null}}):Promise.resolve(null)}const ce="https://covers.openlibrary.org",le=["key","title","author_name","cover_i","cover_edition_key","isbn","first_publish_year","ratings_average","ratings_count","edition_count","subject"].join(",");function de(e){var t,n,o;const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"M";const n=[],o=e.cover_i||e.cover_id;o&&Number(o)>0&&n.push("".concat(ce,"/b/id/").concat(o,"-").concat(t,".jpg"));const r=new Set;for(const a of[...e.isbn||[],...e.isbn_13||[],...e.isbn_10||[]])if(r.has(a)||(r.add(a),n.push("".concat(ce,"/b/isbn/").concat(a,"-").concat(t,".jpg"))),r.size>=3)break;return e.cover_edition_key&&n.push("".concat(ce,"/b/olid/").concat(e.cover_edition_key,"-").concat(t,".jpg")),n}(e,"M");return{key:e.key,title:e.title,author:(null===(t=e.author_name)||void 0===t?void 0:t[0])||(null===(n=e.authors)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.name)||"Unknown",poster_path:r[0]||null,cover_urls:r,isbn:e.isbn||[],first_publish_year:e.first_publish_year,rating:e.ratings_average?Math.round(20*e.ratings_average)/10:null,ratings_count:e.ratings_count||0,want_to_read:e.want_to_read_count||0,already_read:e.already_read_count||0,currently_reading:e.currently_reading_count||0,edition_count:e.edition_count||0,subject:(e.subject||[]).slice(0,5),media_type:"book"}}function ue(e){var t,n;const o=[];return e.cover_id&&Number(e.cover_id)>0&&o.push("".concat(ce,"/b/id/").concat(e.cover_id,"-M.jpg")),e.cover_edition_key&&o.push("".concat(ce,"/b/olid/").concat(e.cover_edition_key,"-M.jpg")),{key:e.key,title:e.title,author:(null===(t=e.authors)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.name)||"Unknown",poster_path:o[0]||null,cover_urls:o,first_publish_year:e.first_publish_year,edition_count:e.edition_count||0,media_type:"book"}}async function ge(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;for(let n=0;n<e.length;n+=t)await Promise.all(e.slice(n,n+t).map(e=>d(e)))}function fe(){return p("ol:trending",async()=>{try{const e=await fetch("".concat(u,"/trending/weekly.json?limit=30"));if(!e.ok)throw new Error(e.status);let t=((await e.json()).works||[]).map(de).slice(0,20);return await ge(t),t.filter(e=>e.cover_urls.length>0)}catch(e){return[]}},y)}function me(e){const t=e.toLowerCase().replace(/\s+/g,"_");return p("ol:subject:".concat(t),async()=>{try{const e=await fetch("".concat(u,"/subjects/").concat(encodeURIComponent(t),".json?limit=24&details=false"));if(!e.ok)throw new Error(e.status);let n=((await e.json()).works||[]).map(ue);return await ge(n),n.filter(e=>e.cover_urls.length>0)}catch(e){return[]}},y)}async function he(e){let t=await s(e,24);if(t.length>0)return t;try{const t=await fetch("".concat(u,"/search.json?q=").concat(encodeURIComponent(e),"&limit=24&fields=").concat(le));if(!t.ok)throw new Error(t.status);const n=((await t.json()).docs||[]).map(de);return await ge(n),n}catch(n){return[]}}function ve(e){if(!e.startsWith("/works/"))return p("gb:detail:".concat(e),async()=>{const t=await async function(e){try{const t=await fetch("".concat(a,"/volumes/").concat(e));if(!t.ok)throw new Error(t.status);return c(await t.json())}catch(t){return null}}(e);return t||ve("/works/".concat(e))},y);const t=e.startsWith("/works/")?e:"/works/".concat(e);return p("ol:detail:".concat(t),async()=>{try{var e,n,o,r,a,i,s,c;const[m,h,v,_]=await Promise.all([fetch("".concat(u).concat(t,".json")).then(e=>e.json()),fetch("".concat(u).concat(t,"/ratings.json")).then(e=>e.json()).catch(()=>null),fetch("".concat(u).concat(t,"/bookshelves.json")).then(e=>e.json()).catch(()=>null),fetch("".concat(u).concat(t,"/editions.json?limit=10")).then(e=>e.json()).catch(()=>null)]),y=(m.authors||[]).map(e=>{var t;return(null===(t=e.author)||void 0===t?void 0:t.key)||e.key}).filter(Boolean).slice(0,5),p=(await Promise.all(y.map(e=>fetch("".concat(u).concat(e,".json")).then(e=>e.json()).catch(()=>null)))).filter(Boolean).map(e=>{var t,n;return{name:e.name||e.personal_name||"Unknown",key:e.key,photo:null!==(t=e.photos)&&void 0!==t&&t[0]?"".concat(ce,"/a/id/").concat(e.photos[0],"-M.jpg"):null,bio:"string"===typeof e.bio?e.bio:(null===(n=e.bio)||void 0===n?void 0:n.value)||""}}),w=[];for(const e of(m.covers||[]).slice(0,3))e>0&&w.push("".concat(ce,"/b/id/").concat(e,"-L.jpg"));for(const e of((null===_||void 0===_?void 0:_.entries)||[]).slice(0,10)){var l,g,f;for(const o of(e.covers||[]).slice(0,2))o>0&&w.push("".concat(ce,"/b/id/").concat(o,"-L.jpg"));const t=(null===(l=e.isbn_13)||void 0===l?void 0:l[0])||(null===(g=e.isbn_10)||void 0===g?void 0:g[0]);t&&w.push("".concat(ce,"/b/isbn/").concat(t,"-L.jpg"));const n=null===(f=e.key)||void 0===f?void 0:f.replace("/books/","");n&&w.push("".concat(ce,"/b/olid/").concat(n,"-L.jpg"))}const b=[...new Set(w)],k="string"===typeof m.description?m.description:(null===(e=m.description)||void 0===e?void 0:e.value)||"",N={key:m.key,title:m.title,author:(null===(n=p[0])||void 0===n?void 0:n.name)||"Unknown",description:k,poster_path:b[0]||null,cover_urls:b,first_publish_date:m.first_publish_date||"",subjects:(m.subjects||[]).slice(0,8),rating:null!==h&&void 0!==h&&null!==(o=h.summary)&&void 0!==o&&o.average?Math.round(20*h.summary.average)/10:null,ratings_count:(null===h||void 0===h||null===(r=h.summary)||void 0===r?void 0:r.count)||0,want_to_read:(null===v||void 0===v||null===(a=v.counts)||void 0===a?void 0:a.want_to_read)||0,currently_reading:(null===v||void 0===v||null===(i=v.counts)||void 0===i?void 0:i.currently_reading)||0,already_read:(null===v||void 0===v||null===(s=v.counts)||void 0===s?void 0:s.already_read)||0,edition_count:(null===_||void 0===_?void 0:_.size)||(null===_||void 0===_||null===(c=_.entries)||void 0===c?void 0:c.length)||0,authors:p,media_type:"book"};return await d(N),N}catch(m){return null}},y)}function _e(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return p(e?"top100:books:".concat(e):"top100:books",async()=>{try{const t=e?"subject:".concat(e):"subject:fiction OR subject:literature",n=await fetch("".concat(u,"/search.json?q=").concat(encodeURIComponent(t),"&sort=rating+desc&limit=150")+"&fields=".concat(le,",want_to_read_count,already_read_count,currently_reading_count"));if(!n.ok)throw new Error(n.status);let o=((await n.json()).docs||[]).filter(e=>(e.ratings_count||0)>=20&&e.ratings_average).sort((e,t)=>(t.ratings_average||0)-(e.ratings_average||0)).slice(0,120).map(de);return await ge(o),o.filter(e=>e.cover_urls.length>0).slice(0,100)}catch(t){return[]}},y)}async function ye(e){const t=e.subjects||e.subject||[];if(0===t.length)return[];for(const o of t.slice(0,3))try{const t=o.toLowerCase().replace(/[\s/]+/g,"_").replace(/[^a-z0-9_]/g,"");if(!t)continue;const n=(await me(t)).filter(t=>t.key!==e.key);if(n.length>=4)return n.slice(0,8)}catch(n){continue}return[]}async function pe(e){const[t,n]=await Promise.all([T("/search/multi","&query=".concat(encodeURIComponent(e))),fetch("".concat(u,"/search.json?q=").concat(encodeURIComponent(e),"&limit=5&fields=key,title,author_name,cover_i,cover_edition_key,isbn,first_publish_year")).then(e=>e.json()).catch(()=>({docs:[]}))]);return[...(t.results||[]).filter(e=>"movie"===e.media_type||"tv"===e.media_type),...(n.docs||[]).slice(0,5).map(de)]}async function we(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{data:{user:t}}=await r.N.auth.getUser();if(!t)throw new Error("Not logged in");let n=r.N.from("library").select("*").eq("user_id",t.id).order("added_at",{ascending:!1});e.media_type&&(n=n.eq("media_type",e.media_type)),e.status&&(n=n.eq("status",e.status));const{data:o,error:a}=await n;if(a)throw a;return o||[]}async function be(e){const{data:{user:t}}=await r.N.auth.getUser();if(!t)throw new Error("Not logged in");let n=r.N.from("library").select("id").eq("user_id",t.id);e.tmdb_id?n=n.eq("tmdb_id",e.tmdb_id):e.openlibrary_key&&(n=n.eq("openlibrary_key",e.openlibrary_key));const{data:a}=await n;if(a&&a.length>0)throw new Error("Already in your library");const{data:i,error:s}=await r.N.from("library").insert((0,o.A)({user_id:t.id,status:"watching"},e)).select().single();if(s)throw s;return i}async function ke(e,t){const{data:{user:n}}=await r.N.auth.getUser();if(!n)throw new Error("Not logged in");const{data:a,error:i}=await r.N.from("library").update((0,o.A)((0,o.A)({},t),{},{updated_at:(new Date).toISOString()})).eq("id",e).eq("user_id",n.id).select().maybeSingle();if(i)throw new Error(i.message||"Update failed");if(!a)throw new Error("Item not found \u2014 it may have been removed");return a}async function Ne(e){const{data:{user:t}}=await r.N.auth.getUser();if(!t)throw new Error("Not logged in");const{error:n}=await r.N.from("library").delete().eq("id",e).eq("user_id",t.id);if(n)throw n}async function Se(e){let{tmdb_id:t,openlibrary_key:n}=e;const{data:{user:o}}=await r.N.auth.getUser();if(!o)return null;let a=r.N.from("library").select("*").eq("user_id",o.id);if(t)a=a.eq("tmdb_id",t);else{if(!n)return null;a=a.eq("openlibrary_key",n)}const{data:i}=await a.maybeSingle();return i||null}const je={all:"",action:"28",comedy:"35",drama:"18",scifi:"878",thriller:"53",romance:"10749",horror:"27",animation:"16",documentary:"99",crime:"80",fantasy:"14",family:"10751"};async function Ae(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=je[e]?"&with_genres=".concat(je[e]):"";return(await T("/discover/movie","&sort_by=vote_average.desc&vote_count.gte=500&vote_average.gte=6".concat(n,"&page=").concat(t))).results||[]}const Re={"date night":{genres:"10749,35",keywords:""},date:{genres:"10749,35",keywords:""},romantic:{genres:"10749",keywords:""},family:{genres:"10751,16",keywords:""},kids:{genres:"10751,16",keywords:""},children:{genres:"10751,16",keywords:""},scary:{genres:"27",keywords:""},horror:{genres:"27",keywords:""},funny:{genres:"35",keywords:""},laugh:{genres:"35",keywords:""},comedy:{genres:"35",keywords:""},cry:{genres:"18,10749",keywords:""},emotional:{genres:"18,10749",keywords:""},sad:{genres:"18",keywords:""},action:{genres:"28",keywords:""},adrenaline:{genres:"28,53",keywords:""},escape:{genres:"14,12,878",keywords:""},"mind off":{genres:"28,12,35",keywords:""},"take my mind":{genres:"28,12,35,14",keywords:""},relax:{genres:"35,10751,10402",keywords:""},chill:{genres:"35,10402",keywords:""},thriller:{genres:"53,9648",keywords:""},suspense:{genres:"53,9648",keywords:""},mystery:{genres:"9648",keywords:""},"mind bending":{genres:"878,9648",keywords:""},trippy:{genres:"878,9648",keywords:""},"sci-fi":{genres:"878",keywords:""},space:{genres:"878",keywords:"1612"},war:{genres:"10752,18",keywords:""},history:{genres:"36",keywords:""},"true story":{genres:"18,36",keywords:"9672"},"based on":{genres:"18",keywords:"9672"},superhero:{genres:"28,878",keywords:"9715"},animated:{genres:"16",keywords:""},anime:{genres:"16",keywords:""},documentary:{genres:"99",keywords:""},learn:{genres:"99,36",keywords:""},inspiring:{genres:"18",keywords:"9748"},motivat:{genres:"18",keywords:"9748"},adventure:{genres:"12,28",keywords:""},fantasy:{genres:"14",keywords:""},magic:{genres:"14",keywords:""},zombie:{genres:"27",keywords:"12377"},survival:{genres:"28,53",keywords:"10349"},heist:{genres:"80,53",keywords:"10051"},"feel good":{genres:"35,10751,10749",keywords:""},wholesome:{genres:"35,10751",keywords:""},"coming of age":{genres:"18",keywords:"10683"},teen:{genres:"18,35",keywords:"10683"},western:{genres:"37",keywords:""},music:{genres:"10402",keywords:""},sport:{genres:"18",keywords:"6075"},revenge:{genres:"28,53",keywords:"10084"}};async function qe(e){const t=e.toLowerCase().trim();let n="",r="";const a=Object.entries(Re).sort((e,t)=>t[0].length-e[0].length);for(const[o,l]of a)if(t.includes(o)){n=l.genres,r=l.keywords;break}if(!n){const n=((await T("/search/keyword","&query=".concat(encodeURIComponent(t)))).results||[]).slice(0,3).map(e=>e.id).join("|");if(n){return((await T("/discover/movie","&with_keywords=".concat(n,"&sort_by=vote_average.desc&vote_count.gte=100"))).results||[]).map(e=>(0,o.A)((0,o.A)({},e),{},{media_type:"movie"}))}return((await T("/search/movie","&query=".concat(encodeURIComponent(e)))).results||[]).map(e=>(0,o.A)((0,o.A)({},e),{},{media_type:"movie"}))}const i=r?"&with_keywords=".concat(r):"",[s,c]=await Promise.all([T("/discover/movie","&with_genres=".concat(n).concat(i,"&sort_by=vote_average.desc&vote_count.gte=200&page=").concat(Math.floor(3*Math.random())+1)),T("/discover/tv","&with_genres=".concat(n.replace("10752","10768").replace("10751","10751")).concat(i,"&sort_by=vote_average.desc&vote_count.gte=200&page=").concat(Math.floor(2*Math.random())+1))]);return[...(s.results||[]).map(e=>(0,o.A)((0,o.A)({},e),{},{media_type:"movie"})),...(c.results||[]).map(e=>(0,o.A)((0,o.A)({},e),{},{media_type:"tv"}))].sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)).slice(0,20)}const Ie={light:{movie:"35,10751,10402",tv:"35,10751"},dark:{movie:"28,53,27,80",tv:"28,80,9648"},mind:{movie:"878,9648,14",tv:"878,9648"},feel:{movie:"10749,18,10402",tv:"10749,18"},adventure:{movie:"12,28,14",tv:"10759,14"},chill:{movie:"99,36,10770",tv:"99,10764"}};async function Ce(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"movie";const o=(null===(t=Ie[e])||void 0===t?void 0:t[n])||Ie.light[n],r="movie"===n?"/discover/movie":"/discover/tv";return(await T(r,"&with_genres=".concat(o,"&sort_by=vote_average.desc&vote_count.gte=200&page=").concat(Math.floor(3*Math.random())+1))).results||[]}async function Me(e){if(!e||0===e.length)return[];const t=[...e.filter(e=>"finished"===e.status&&"book"!==e.media_type).sort((e,t)=>(t.user_rating||t.external_rating||0)-(e.user_rating||e.external_rating||0)).slice(0,5),...e.filter(e=>"watching"===e.status&&"book"!==e.media_type).slice(0,3)].slice(0,6);if(0===t.length)return[];const n=await Promise.all(t.map(async e=>{try{var t;const n="tv"===e.media_type?"/tv/".concat(e.tmdb_id):"/movie/".concat(e.tmdb_id);return((null===(t=(await T(n,"&append_to_response=recommendations")).recommendations)||void 0===t?void 0:t.results)||[]).map(t=>(0,o.A)((0,o.A)({},t),{},{media_type:t.media_type||e.media_type,_source:e.title,_sourceRating:e.user_rating||e.external_rating||0}))}catch(n){return[]}})),r=new Set(e.map(e=>String(e.tmdb_id))),a=new Set,i=n.flat().filter(e=>{const t="".concat(e.media_type,"-").concat(e.id);return!a.has(t)&&!r.has(String(e.id))&&(a.add(t),!0)});return i.sort((e,t)=>{const n=(e.vote_average||0)+e._sourceRating/10;return(t.vote_average||0)+t._sourceRating/10-n}),i.slice(0,20)}const Ee={Adventurer:["Neo","Trinity","Ripley","Goku","Totoro","Yoda","Athena","Zephyr","Cosmo","Pixel","Blaze","Orbit"].map(e=>"https://api.dicebear.com/9.x/adventurer/svg?seed=".concat(e)),Portraits:["Sora","Luna","Kai","Ember","Storm","Phoenix","Aurora","Vesper","Cleo","Nyx","Zenith","Opal"].map(e=>"https://api.dicebear.com/9.x/lorelei/svg?seed=".concat(e)),Personas:["Hero","Villain","Sage","Rebel","Ghost","Ninja","Druid","Rogue","Titan","Oracle","Drift","Hex"].map(e=>"https://api.dicebear.com/9.x/personas/svg?seed=".concat(e)),Minimal:["Ace","Maverick","Raven","Atlas","Echo","Cipher","Nova","Flux","Prism","Quasar","Onyx","Aero"].map(e=>"https://api.dicebear.com/9.x/notionists/svg?seed=".concat(e)),"Pixel Art":["Mario","Zelda","Link","Samus","Kirby","Fox","Pikachu","Cloud","Sonic","Megaman","Pac","Snake"].map(e=>"https://api.dicebear.com/9.x/pixel-art/svg?seed=".concat(e)),"Big Smile":["Joy","Sunny","Breeze","Coral","Daisy","Mint","Fern","Copper","Sienna","Jade","Willow","Ivy"].map(e=>"https://api.dicebear.com/9.x/big-smile/svg?seed=".concat(e)),"Fun Emoji":["Happy","Cool","Chill","Zen","Fire","Sparkle","Wave","Star","Moon","Rain","Snow","Thunder"].map(e=>"https://api.dicebear.com/9.x/fun-emoji/svg?seed=".concat(e)),Thumbs:["Alpha","Bravo","Charlie","Delta","Echo","Foxtrot","Golf","Hotel","India","Juliet","Kilo","Lima"].map(e=>"https://api.dicebear.com/9.x/thumbs/svg?seed=".concat(e)),Bottts:["Robo1","Mech","Droid","Bolt","Gear","Chip","Wire","Core","Node","Byte","Data","Grid"].map(e=>"https://api.dicebear.com/9.x/bottts/svg?seed=".concat(e)),Shapes:["Ruby","Emerald","Sapphire","Diamond","Topaz","Amethyst","Pearl","Garnet","Citrine","Peridot","Tanzanite","Aqua"].map(e=>"https://api.dicebear.com/9.x/shapes/svg?seed=".concat(e))};async function xe(e){const{data:t}=await r.N.from("profiles").select("*").eq("id",e).maybeSingle();return t}async function Ue(){var e,t;const{data:{user:n}}=await r.N.auth.getUser();if(!n)return null;const{data:o}=await r.N.from("profiles").select("*").eq("id",n.id).maybeSingle();if(o)return o;const a=(null===(e=n.user_metadata)||void 0===e?void 0:e.username)||(null===(t=n.email)||void 0===t?void 0:t.split("@")[0])||"user",{data:i,error:s}=await r.N.from("profiles").upsert({id:n.id,username:a},{onConflict:"id"}).select().single();return s?(console.error("Auto-create profile failed:",s),null):i}async function Oe(e){const{data:{user:t}}=await r.N.auth.getUser();if(!t)throw new Error("Not logged in");const{data:n,error:a}=await r.N.from("profiles").upsert((0,o.A)((0,o.A)({id:t.id},e),{},{updated_at:(new Date).toISOString()}),{onConflict:"id"}).select().single();if(a)throw a;return n}async function De(e){const{data:{user:t}}=await r.N.auth.getUser(),{data:n}=await r.N.from("profiles").select("*").ilike("username","%".concat(e,"%")).limit(20);return(n||[]).filter(e=>e.id!==(null===t||void 0===t?void 0:t.id))}async function Le(e){const{data:{user:t}}=await r.N.auth.getUser();if(!t)throw new Error("Not logged in");const{error:n}=await r.N.from("follows").insert({follower_id:t.id,following_id:e});if(n)throw n;const o=await xe(e);await Je({action:"followed",title:(null===o||void 0===o?void 0:o.username)||"someone"})}async function Pe(e){const{data:{user:t}}=await r.N.auth.getUser();if(!t)throw new Error("Not logged in");const{error:n}=await r.N.from("follows").delete().eq("follower_id",t.id).eq("following_id",e);if(n)throw n}async function Te(e){const{data:t}=await r.N.from("follows").select("following_id, profiles!follows_following_id_fkey(*)").eq("follower_id",e);return(t||[]).map(e=>e.profiles).filter(Boolean)}async function Be(e){const{data:t}=await r.N.from("follows").select("follower_id, profiles!follows_follower_id_fkey(*)").eq("following_id",e);return(t||[]).map(e=>e.profiles).filter(Boolean)}async function Fe(e){const{data:{user:t}}=await r.N.auth.getUser();if(!t)return!1;const{data:n}=await r.N.from("follows").select("id").eq("follower_id",t.id).eq("following_id",e).maybeSingle();return!!n}async function Je(e){const{data:{user:t}}=await r.N.auth.getUser();t&&await r.N.from("activity").insert((0,o.A)({user_id:t.id},e)).select()}async function ze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;const{data:{user:t}}=await r.N.auth.getUser();if(!t)return[];const{data:n}=await r.N.from("follows").select("following_id").eq("follower_id",t.id),o=(n||[]).map(e=>e.following_id);if(0===o.length)return[];const{data:a}=await r.N.from("activity").select("*, profiles!activity_user_id_fkey(username, avatar_url)").in("user_id",o).order("created_at",{ascending:!1}).limit(e);return a||[]}async function We(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;const{data:{user:t}}=await r.N.auth.getUser();if(!t)return[];const{data:n}=await r.N.from("activity").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(e);return n||[]}async function Ve(e){const{data:{user:t}}=await r.N.auth.getUser();if(!t)return null;const[n,o]=await Promise.all([r.N.from("library").select("*").eq("user_id",t.id).then(e=>e.data||[]),r.N.from("library").select("*").eq("user_id",e).then(e=>e.data||[])]),a=new Set(n.map(e=>e.tmdb_id||e.openlibrary_key).filter(Boolean)),i=o.filter(e=>a.has(e.tmdb_id||e.openlibrary_key)),s={};n.forEach(e=>(e.genres||"").split(",").forEach(e=>{const t=e.trim();t&&(s[t]=(s[t]||0)+1)}));const c={};o.forEach(e=>(e.genres||"").split(",").forEach(e=>{const t=e.trim();t&&(c[t]=(c[t]||0)+1)}));const l=Object.keys(s).filter(e=>c[e]).map(e=>({genre:e,overlap:Math.min(s[e],c[e])})).sort((e,t)=>t.overlap-e.overlap).slice(0,5),d=Math.max(n.length,o.length,1),u=Math.min(100,Math.round(i.length/d*100+5*l.length));let g=[];if(l.length>0){const e={Action:28,Comedy:35,Drama:18,Horror:27,Romance:10749,Thriller:53,"Sci-Fi":878,Animation:16,Crime:80,Documentary:99,Adventure:12,Fantasy:14,Mystery:9648,"Science Fiction":878}[l[0].genre];if(e){const t=await K(e),r=new Set([...n,...o].map(e=>e.tmdb_id).filter(Boolean));g=t.filter(e=>!r.has(e.id)).slice(0,10)}}return{shared:i,sharedGenres:l,compatibility:u,blendRecs:g,myCount:n.length,friendCount:o.length}}async function Ge(){const{data:{user:e}}=await r.N.auth.getUser();if(!e)return[];const t=await we();if(t.length<3)return[];const n=[...t].sort((e,t)=>(t.user_rating||t.external_rating||0)-(e.user_rating||e.external_rating||0)).slice(0,5).filter(e=>e.tmdb_id);if(0===n.length)return[];const a=await Promise.all(n.map(async e=>{try{const t="tv"===e.media_type?"tv":"movie";return((await T("/".concat(t,"/").concat(e.tmdb_id,"/recommendations"))).results||[]).map(e=>(0,o.A)((0,o.A)({},e),{},{media_type:t}))}catch(t){return[]}})),i=new Set(t.map(e=>String(e.tmdb_id))),s=new Set,c=a.flat().filter(e=>{const t="".concat(e.media_type,"-").concat(e.id);return!s.has(t)&&!i.has(String(e.id))&&(s.add(t),!0)});return c.sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)),c.slice(0,20)}async function He(e){const{data:t}=await r.N.from("library").select("*").eq("user_id",e).order("added_at",{ascending:!1});return t||[]}},3944(e,t,n){n.d(t,{A:()=>o});const o=(0,n(1212).A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])}}]);
//# sourceMappingURL=942.fd870ec1.chunk.js.map