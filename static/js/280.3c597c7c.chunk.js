/*! For license information please see 280.3c597c7c.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunksyllabus_client=self.webpackChunksyllabus_client||[]).push([[280],{4505(e,t,r){r.d(t,{$t:()=>T,AD:()=>$,BI:()=>q,E$:()=>le,FE:()=>P,G9:()=>Y,I1:()=>ie,Jp:()=>ke,LF:()=>j,Mx:()=>_e,NC:()=>I,Nt:()=>k,Nw:()=>ee,O4:()=>X,OA:()=>we,Qt:()=>ye,SR:()=>ve,TA:()=>ce,UQ:()=>be,Ve:()=>z,Ww:()=>E,XT:()=>x,Y2:()=>W,Y8:()=>Ne,Zb:()=>f,a3:()=>F,aP:()=>oe,ai:()=>se,bm:()=>A,c0:()=>R,cy:()=>L,e8:()=>G,eS:()=>S,eY:()=>H,f2:()=>re,h2:()=>Z,j9:()=>B,kr:()=>C,ks:()=>pe,lO:()=>he,mH:()=>fe,nK:()=>O,pV:()=>ge,q1:()=>K,q8:()=>N,qv:()=>J,qx:()=>de,r7:()=>ue,tT:()=>M,w7:()=>Q,wM:()=>U,wO:()=>y,x5:()=>me,yN:()=>g});var n=r(2555),o=r(1144);const a="4a3b711b",i="https://openlibrary.org",s=new Map;function c(e,t){const r=s.get(e);return r&&Date.now()-r.ts<3e5?Promise.resolve(r.data):t().then(t=>(s.set(e,{data:t,ts:Date.now()}),t))}const l="syllabus_scores",d="syllabus_omdb";let u=null;function m(){if(!u)try{u=JSON.parse(localStorage.getItem(l)||"{}")}catch(e){u={}}return u}function g(e,t){var r;return null!==(r=m()["".concat(e,":").concat(t)])&&void 0!==r?r:null}function y(e,t,r){if(null==r||!t)return;m()["".concat(e,":").concat(t)]=r,function(){try{localStorage.setItem(l,JSON.stringify(u))}catch(e){}}()}function f(e,t){const r=m();return e.forEach(e=>{const n="".concat(t,":").concat(e.id);null!=r[n]&&(e.unified_rating=r[n])}),e}let v=null;function h(){if(!v)try{v=JSON.parse(localStorage.getItem(d)||"{}");let t=!1;for(const e of Object.keys(v))null===v[e]&&(delete v[e],t=!0);if(t)try{localStorage.setItem(d,JSON.stringify(v))}catch(e){}}catch(t){v={}}return v}function _(e,t){const r=h();r[e]=t;try{localStorage.setItem(d,JSON.stringify(r))}catch(n){}}function p(e){var t;return null!==(t=h()[e])&&void 0!==t?t:void 0}async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(await fetch("".concat("https://api.themoviedb.org/3").concat(e,"?api_key=").concat("e78b9789ddab05e594a195dc997e9c3f").concat(t))).json()}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return c("tmdb:".concat(e).concat(t),()=>w(e,t))}function k(){return b("/trending/movie/week").then(e=>e.results||[])}async function N(e){return(await w("/search/movie","&query=".concat(encodeURIComponent(e)))).results||[]}function j(e){return b("/movie/".concat(e),"&append_to_response=recommendations,credits,watch/providers,external_ids,videos")}function S(){return b("/trending/tv/week").then(e=>e.results||[])}async function A(e){return(await w("/search/tv","&query=".concat(encodeURIComponent(e)))).results||[]}function q(e){return b("/tv/".concat(e),"&append_to_response=recommendations,credits,watch/providers,external_ids,videos")}function x(){return b("/movie/top_rated").then(e=>e.results||[])}function C(){return b("/movie/now_playing").then(e=>e.results||[])}function R(e){return b("/discover/movie","&with_genres=".concat(e,"&sort_by=popularity.desc&vote_count.gte=50")).then(e=>e.results||[])}function U(){return b("/tv/top_rated").then(e=>e.results||[])}function M(e){return b("/discover/tv","&with_genres=".concat(e,"&sort_by=popularity.desc&vote_count.gte=50")).then(e=>e.results||[])}function P(){return b("/discover/tv","&with_genres=16&with_original_language=ja&sort_by=popularity.desc&vote_count.gte=50").then(e=>e.results||[])}function I(){return b("/discover/tv","&with_genres=16&without_original_language=ja&sort_by=popularity.desc&vote_count.gte=20").then(e=>e.results||[])}function E(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return c(e?"top100:movies:".concat(e):"top100:movies",async()=>{if(e){const t=await Promise.all([1,2,3,4,5].map(t=>w("/discover/movie","&sort_by=vote_average.desc&vote_count.gte=1000&with_genres=".concat(e,"&page=").concat(t)))),r=new Set;return t.flatMap(e=>e.results||[]).filter(e=>!r.has(e.id)&&(r.add(e.id),!0))}return(await Promise.all([1,2,3,4,5].map(e=>w("/movie/top_rated","&page=".concat(e))))).flatMap(e=>e.results||[])})}function O(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return c(e?"top100:tv:".concat(e):"top100:tv",async()=>{if(e){const t=await Promise.all([1,2,3,4,5].map(t=>w("/discover/tv","&sort_by=vote_average.desc&vote_count.gte=500&with_genres=".concat(e,"&page=").concat(t)))),r=new Set;return t.flatMap(e=>e.results||[]).filter(e=>!r.has(e.id)&&(r.add(e.id),!0))}return(await Promise.all([1,2,3,4,5].map(e=>w("/tv/top_rated","&page=".concat(e))))).flatMap(e=>e.results||[])})}function D(e){if(!e||"False"===e.Response)return null;const t={imdb_id:e.imdbID};return(e.Ratings||[]).forEach(r=>{"Internet Movie Database"===r.Source?t.imdb={score:r.Value,votes:e.imdbVotes}:"Rotten Tomatoes"===r.Source?t.rt={score:r.Value}:"Metacritic"===r.Source&&(t.metacritic={score:r.Value})}),e.Director&&"N/A"!==e.Director&&(t.director=e.Director),e.Writer&&"N/A"!==e.Writer&&(t.writer=e.Writer),e.Awards&&"N/A"!==e.Awards&&(t.awards=e.Awards),e.BoxOffice&&"N/A"!==e.BoxOffice&&(t.boxOffice=e.BoxOffice),e.Rated&&"N/A"!==e.Rated&&(t.rated=e.Rated),e.Country&&"N/A"!==e.Country&&(t.country=e.Country),t}function B(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return Promise.resolve(null);const n="i:".concat(e),o=p(n);return void 0!==o?Promise.resolve(o):c("omdb:".concat(e),async()=>{try{const o=await fetch("https://www.omdbapi.com/?i=".concat(e,"&apikey=").concat(a)),i=await o.json();if("Request limit reached!"===i.Error)return null;const s=D(i);if(!s)return _(n,null),null;if(!s.rt&&t){const e="tv"===r?"series":"movie"===r?"movie":"";let n="https://www.omdbapi.com/?t=".concat(encodeURIComponent(t),"&apikey=").concat(a);e&&(n+="&type=".concat(e));const o=await fetch(n),i=await o.json();"False"!==i.Response&&(i.Ratings||[]).forEach(e=>{"Rotten Tomatoes"!==e.Source||s.rt||(s.rt={score:e.Value})})}return _(n,s),s}catch(o){return null}})}function F(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"movie";if(!e)return Promise.resolve(null);const n="tv"===r?"series":"movie",o="t:".concat(e,":").concat(t||"",":").concat(n),i=p(o);return void 0!==i?Promise.resolve(i):c("omdb:t:".concat(e,":").concat(t||"",":").concat(n),async()=>{try{let r="https://www.omdbapi.com/?t=".concat(encodeURIComponent(e),"&type=").concat(n,"&apikey=").concat(a);t&&(r+="&y=".concat(t));const i=await fetch(r),s=D(await i.json());return _(o,s),s}catch(r){return null}})}function T(e,t,r){var n;const o=[];if(null!==e&&void 0!==e&&null!==(n=e.imdb)&&void 0!==n&&n.score){const t=parseFloat(e.imdb.score);isNaN(t)||o.push(t)}var a;if(r)null!==t&&void 0!==t&&t.score&&o.push(t.score);else if(null!==e&&void 0!==e&&null!==(a=e.rt)&&void 0!==a&&a.score){const t=parseInt(e.rt.score);isNaN(t)||o.push(t/10)}return 0===o.length?null:parseFloat((o.reduce((e,t)=>e+t,0)/o.length).toFixed(1))}function L(e,t){return c("enriched:".concat(t,":").concat(e.map(e=>e.id||e.key).join(",")),async()=>{const r=e.map(e=>(0,n.A)({},e)),o=m(),a=[];r.forEach(e=>{const r="".concat(t,":").concat(e.id);null!=o[r]?e.unified_rating=o[r]:a.push(e)});for(let e=0;e<a.length;e+=10){const r=a.slice(e,e+10);await Promise.all(r.map(async e=>{var r,n;const o=e.title||e.name,a=(e.release_date||e.first_air_date||"").slice(0,4),i="ja"===e.original_language&&((null===(r=e.genre_ids)||void 0===r?void 0:r.includes(16))||(null===(n=e.genres)||void 0===n?void 0:n.some(e=>16===e.id))),s=await F(o,a,t);let c=null;if(i)try{c=await J(o)}catch(l){}e.unified_rating=T(s,c,i),null!=e.unified_rating&&y(t,e.id,e.unified_rating)}))}return r.sort((e,t)=>{var r,n,o,a,i,s;const c=null!==(r=null!==(n=null!==(o=e.unified_rating)&&void 0!==o?o:e.vote_average)&&void 0!==n?n:e.rating)&&void 0!==r?r:0;return(null!==(a=null!==(i=null!==(s=t.unified_rating)&&void 0!==s?s:t.vote_average)&&void 0!==i?i:t.rating)&&void 0!==a?a:0)-c}),r})}function J(e){return e?c("mal:".concat(e),async()=>{try{var t;const r=await fetch("https://api.jikan.moe/v4/anime?q=".concat(encodeURIComponent(e),"&limit=1")),n=null===(t=(await r.json()).data)||void 0===t?void 0:t[0];return n?{score:n.score,scored_by:n.scored_by,mal_id:n.mal_id,url:n.url}:null}catch(r){return null}}):Promise.resolve(null)}function V(e){var t,r,n,o;const a=e.cover_i||e.cover_id;return{key:e.key,title:e.title,author:(null===(t=e.author_name)||void 0===t?void 0:t[0])||(null===(r=e.authors)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.name)||"Unknown",cover_id:a,poster_path:a?"https://covers.openlibrary.org/b/id/".concat(a,"-L.jpg"):null,first_publish_year:e.first_publish_year,rating:e.ratings_average?Math.round(20*e.ratings_average)/10:null,ratings_count:e.ratings_count||0,want_to_read:e.want_to_read_count||0,already_read:e.already_read_count||0,currently_reading:e.currently_reading_count||0,edition_count:e.edition_count||0,subject:(null===(o=e.subject)||void 0===o?void 0:o.slice(0,5))||[],media_type:"book"}}function G(){return c("ol:trending",async()=>{try{const e=await fetch("".concat(i,"/trending/daily.json?limit=20"));return((await e.json()).works||[]).map(V)}catch(e){return[]}})}function W(e){return c("ol:subject:".concat(e),async()=>{try{const t=await fetch("".concat(i,"/subjects/").concat(encodeURIComponent(e),".json?limit=20"));return((await t.json()).works||[]).map(t=>{var r,n;return{key:t.key,title:t.title,author:(null===(r=t.authors)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.name)||"Unknown",cover_id:t.cover_id,poster_path:t.cover_id?"https://covers.openlibrary.org/b/id/".concat(t.cover_id,"-L.jpg"):null,first_publish_year:t.first_publish_year,rating:null,subject:[e],media_type:"book"}})}catch(t){return[]}})}async function z(e){try{const t=await fetch("".concat(i,"/search.json?q=").concat(encodeURIComponent(e),"&limit=20&fields=key,title,author_name,cover_i,first_publish_year,ratings_average,ratings_count,want_to_read_count,already_read_count,currently_reading_count,edition_count,subject"));return((await t.json()).docs||[]).map(V)}catch(t){return[]}}function H(e){const t=e.startsWith("/works/")?e:"/works/".concat(e);return c("ol:detail:".concat(t),async()=>{try{var e,r,n,o,a,s,c,l;const[d,u,m,g]=await Promise.all([fetch("".concat(i).concat(t,".json")).then(e=>e.json()),fetch("".concat(i).concat(t,"/ratings.json")).then(e=>e.json()).catch(()=>null),fetch("".concat(i).concat(t,"/bookshelves.json")).then(e=>e.json()).catch(()=>null),fetch("".concat(i).concat(t,"/editions.json?limit=1")).then(e=>e.json()).catch(()=>null)]);let y=[];if(d.authors&&d.authors.length>0){const e=d.authors.map(e=>{var t;return(null===(t=e.author)||void 0===t?void 0:t.key)||e.key}).filter(Boolean);y=(await Promise.all(e.slice(0,5).map(e=>fetch("".concat(i).concat(e,".json")).then(e=>e.json()).catch(()=>null)))).filter(Boolean).map(e=>{var t,r;return{name:e.name||e.personal_name||"Unknown",key:e.key,photo:null!==(t=e.photos)&&void 0!==t&&t[0]?"https://covers.openlibrary.org/a/id/".concat(e.photos[0],"-M.jpg"):null,bio:"string"===typeof e.bio?e.bio:(null===(r=e.bio)||void 0===r?void 0:r.value)||""}})}const f=null===(e=d.covers)||void 0===e?void 0:e[0],v="string"===typeof d.description?d.description:(null===(r=d.description)||void 0===r?void 0:r.value)||"";return{key:d.key,title:d.title,description:v,cover_id:f,poster_path:f?"https://covers.openlibrary.org/b/id/".concat(f,"-L.jpg"):null,first_publish_date:d.first_publish_date||"",subjects:(d.subjects||[]).slice(0,8),rating:null!==u&&void 0!==u&&null!==(n=u.summary)&&void 0!==n&&n.average?Math.round(20*u.summary.average)/10:null,ratings_count:(null===u||void 0===u||null===(o=u.summary)||void 0===o?void 0:o.count)||0,want_to_read:(null===m||void 0===m||null===(a=m.counts)||void 0===a?void 0:a.want_to_read)||0,currently_reading:(null===m||void 0===m||null===(s=m.counts)||void 0===s?void 0:s.currently_reading)||0,already_read:(null===m||void 0===m||null===(c=m.counts)||void 0===c?void 0:c.already_read)||0,edition_count:(null===g||void 0===g?void 0:g.size)||(null===g||void 0===g||null===(l=g.entries)||void 0===l?void 0:l.length)||0,authors:y,media_type:"book"}}catch(d){return null}})}function Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return c(e?"top100:books:".concat(e):"top100:books",async()=>{try{const t=e?"subject:".concat(e):"subject:fiction OR subject:literature",r=await fetch("".concat(i,"/search.json?q=").concat(encodeURIComponent(t),"&sort=rating&limit=100&fields=key,title,author_name,cover_i,first_publish_year,ratings_average,ratings_count,want_to_read_count,already_read_count,currently_reading_count,edition_count,subject"));return((await r.json()).docs||[]).filter(e=>(e.ratings_count||0)>=10).map(V)}catch(t){return[]}})}async function K(e){const[t,r]=await Promise.all([w("/search/multi","&query=".concat(encodeURIComponent(e))),fetch("".concat(i,"/search.json?q=").concat(encodeURIComponent(e),"&limit=5&fields=key,title,author_name,cover_i,first_publish_year")).then(e=>e.json()).catch(()=>({docs:[]}))]);return[...(t.results||[]).filter(e=>"movie"===e.media_type||"tv"===e.media_type),...(r.docs||[]).slice(0,5).map(V)]}async function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{data:{user:t}}=await o.N.auth.getUser();if(!t)throw new Error("Not logged in");let r=o.N.from("library").select("*").eq("user_id",t.id).order("added_at",{ascending:!1});e.media_type&&(r=r.eq("media_type",e.media_type)),e.status&&(r=r.eq("status",e.status));const{data:n,error:a}=await r;if(a)throw a;return n||[]}async function Q(e){const{data:{user:t}}=await o.N.auth.getUser();if(!t)throw new Error("Not logged in");let r=o.N.from("library").select("id").eq("user_id",t.id);e.tmdb_id?r=r.eq("tmdb_id",e.tmdb_id):e.openlibrary_key&&(r=r.eq("openlibrary_key",e.openlibrary_key));const{data:a}=await r;if(a&&a.length>0)throw new Error("Already in your library");const{data:i,error:s}=await o.N.from("library").insert((0,n.A)({user_id:t.id,status:"watching"},e)).select().single();if(s)throw s;return i}async function $(e,t){const{data:{user:r}}=await o.N.auth.getUser();if(!r)throw new Error("Not logged in");const{data:a,error:i}=await o.N.from("library").update((0,n.A)((0,n.A)({},t),{},{updated_at:(new Date).toISOString()})).eq("id",e).eq("user_id",r.id).select().maybeSingle();if(i)throw new Error(i.message||"Update failed");if(!a)throw new Error("Item not found \u2014 it may have been removed");return a}async function X(e){const{data:{user:t}}=await o.N.auth.getUser();if(!t)throw new Error("Not logged in");const{error:r}=await o.N.from("library").delete().eq("id",e).eq("user_id",t.id);if(r)throw r}async function ee(e){let{tmdb_id:t,openlibrary_key:r}=e;const{data:{user:n}}=await o.N.auth.getUser();if(!n)return null;let a=o.N.from("library").select("*").eq("user_id",n.id);if(t)a=a.eq("tmdb_id",t);else{if(!r)return null;a=a.eq("openlibrary_key",r)}const{data:i}=await a.maybeSingle();return i||null}const te={all:"",action:"28",comedy:"35",drama:"18",scifi:"878",thriller:"53",romance:"10749",horror:"27",animation:"16",documentary:"99",crime:"80",fantasy:"14",family:"10751"};async function re(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const r=te[e]?"&with_genres=".concat(te[e]):"";return(await w("/discover/movie","&sort_by=vote_average.desc&vote_count.gte=500&vote_average.gte=6".concat(r,"&page=").concat(t))).results||[]}const ne={"date night":{genres:"10749,35",keywords:""},date:{genres:"10749,35",keywords:""},romantic:{genres:"10749",keywords:""},family:{genres:"10751,16",keywords:""},kids:{genres:"10751,16",keywords:""},children:{genres:"10751,16",keywords:""},scary:{genres:"27",keywords:""},horror:{genres:"27",keywords:""},funny:{genres:"35",keywords:""},laugh:{genres:"35",keywords:""},comedy:{genres:"35",keywords:""},cry:{genres:"18,10749",keywords:""},emotional:{genres:"18,10749",keywords:""},sad:{genres:"18",keywords:""},action:{genres:"28",keywords:""},adrenaline:{genres:"28,53",keywords:""},escape:{genres:"14,12,878",keywords:""},"mind off":{genres:"28,12,35",keywords:""},"take my mind":{genres:"28,12,35,14",keywords:""},relax:{genres:"35,10751,10402",keywords:""},chill:{genres:"35,10402",keywords:""},thriller:{genres:"53,9648",keywords:""},suspense:{genres:"53,9648",keywords:""},mystery:{genres:"9648",keywords:""},"mind bending":{genres:"878,9648",keywords:""},trippy:{genres:"878,9648",keywords:""},"sci-fi":{genres:"878",keywords:""},space:{genres:"878",keywords:"1612"},war:{genres:"10752,18",keywords:""},history:{genres:"36",keywords:""},"true story":{genres:"18,36",keywords:"9672"},"based on":{genres:"18",keywords:"9672"},superhero:{genres:"28,878",keywords:"9715"},animated:{genres:"16",keywords:""},anime:{genres:"16",keywords:""},documentary:{genres:"99",keywords:""},learn:{genres:"99,36",keywords:""},inspiring:{genres:"18",keywords:"9748"},motivat:{genres:"18",keywords:"9748"},adventure:{genres:"12,28",keywords:""},fantasy:{genres:"14",keywords:""},magic:{genres:"14",keywords:""},zombie:{genres:"27",keywords:"12377"},survival:{genres:"28,53",keywords:"10349"},heist:{genres:"80,53",keywords:"10051"},"feel good":{genres:"35,10751,10749",keywords:""},wholesome:{genres:"35,10751",keywords:""},"coming of age":{genres:"18",keywords:"10683"},teen:{genres:"18,35",keywords:"10683"},western:{genres:"37",keywords:""},music:{genres:"10402",keywords:""},sport:{genres:"18",keywords:"6075"},revenge:{genres:"28,53",keywords:"10084"}};async function oe(e){const t=e.toLowerCase().trim();let r="",o="";const a=Object.entries(ne).sort((e,t)=>t[0].length-e[0].length);for(const[n,l]of a)if(t.includes(n)){r=l.genres,o=l.keywords;break}if(!r){const r=((await w("/search/keyword","&query=".concat(encodeURIComponent(t)))).results||[]).slice(0,3).map(e=>e.id).join("|");if(r){return((await w("/discover/movie","&with_keywords=".concat(r,"&sort_by=vote_average.desc&vote_count.gte=100"))).results||[]).map(e=>(0,n.A)((0,n.A)({},e),{},{media_type:"movie"}))}return((await w("/search/movie","&query=".concat(encodeURIComponent(e)))).results||[]).map(e=>(0,n.A)((0,n.A)({},e),{},{media_type:"movie"}))}const i=o?"&with_keywords=".concat(o):"",[s,c]=await Promise.all([w("/discover/movie","&with_genres=".concat(r).concat(i,"&sort_by=vote_average.desc&vote_count.gte=200&page=").concat(Math.floor(3*Math.random())+1)),w("/discover/tv","&with_genres=".concat(r.replace("10752","10768").replace("10751","10751")).concat(i,"&sort_by=vote_average.desc&vote_count.gte=200&page=").concat(Math.floor(2*Math.random())+1))]);return[...(s.results||[]).map(e=>(0,n.A)((0,n.A)({},e),{},{media_type:"movie"})),...(c.results||[]).map(e=>(0,n.A)((0,n.A)({},e),{},{media_type:"tv"}))].sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)).slice(0,20)}const ae={light:{movie:"35,10751,10402",tv:"35,10751"},dark:{movie:"28,53,27,80",tv:"28,80,9648"},mind:{movie:"878,9648,14",tv:"878,9648"},feel:{movie:"10749,18,10402",tv:"10749,18"},adventure:{movie:"12,28,14",tv:"10759,14"},chill:{movie:"99,36,10770",tv:"99,10764"}};async function ie(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"movie";const n=(null===(t=ae[e])||void 0===t?void 0:t[r])||ae.light[r],o="movie"===r?"/discover/movie":"/discover/tv";return(await w(o,"&with_genres=".concat(n,"&sort_by=vote_average.desc&vote_count.gte=200&page=").concat(Math.floor(3*Math.random())+1))).results||[]}async function se(e){if(!e||0===e.length)return[];const t=[...e.filter(e=>"finished"===e.status&&"book"!==e.media_type).sort((e,t)=>(t.user_rating||t.external_rating||0)-(e.user_rating||e.external_rating||0)).slice(0,5),...e.filter(e=>"watching"===e.status&&"book"!==e.media_type).slice(0,3)].slice(0,6);if(0===t.length)return[];const r=await Promise.all(t.map(async e=>{try{var t;const r="tv"===e.media_type?"/tv/".concat(e.tmdb_id):"/movie/".concat(e.tmdb_id);return((null===(t=(await w(r,"&append_to_response=recommendations")).recommendations)||void 0===t?void 0:t.results)||[]).map(t=>(0,n.A)((0,n.A)({},t),{},{media_type:t.media_type||e.media_type,_source:e.title,_sourceRating:e.user_rating||e.external_rating||0}))}catch(r){return[]}})),o=new Set(e.map(e=>String(e.tmdb_id))),a=new Set,i=r.flat().filter(e=>{const t="".concat(e.media_type,"-").concat(e.id);return!a.has(t)&&!o.has(String(e.id))&&(a.add(t),!0)});return i.sort((e,t)=>{const r=(e.vote_average||0)+e._sourceRating/10;return(t.vote_average||0)+t._sourceRating/10-r}),i.slice(0,20)}const ce={Adventurer:["Neo","Trinity","Ripley","Goku","Totoro","Yoda","Athena","Zephyr","Cosmo","Pixel","Blaze","Orbit"].map(e=>"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(e)),Portraits:["Sora","Luna","Kai","Ember","Storm","Phoenix","Aurora","Vesper","Cleo","Nyx","Zenith","Opal"].map(e=>"https://api.dicebear.com/7.x/lorelei/svg?seed=".concat(e)),Personas:["Hero","Villain","Sage","Rebel","Ghost","Ninja","Druid","Rogue","Titan","Oracle","Drift","Hex"].map(e=>"https://api.dicebear.com/7.x/personas/svg?seed=".concat(e)),Minimal:["Ace","Maverick","Raven","Atlas","Echo","Cipher","Nova","Flux","Prism","Quasar","Onyx","Aero"].map(e=>"https://api.dicebear.com/7.x/notionists/svg?seed=".concat(e)),"Pixel Art":["Mario","Zelda","Link","Samus","Kirby","Fox","Pikachu","Cloud","Sonic","Megaman","Pac","Snake"].map(e=>"https://api.dicebear.com/7.x/pixel-art/svg?seed=".concat(e)),"Big Smile":["Joy","Sunny","Breeze","Coral","Daisy","Mint","Fern","Copper","Sienna","Jade","Willow","Ivy"].map(e=>"https://api.dicebear.com/7.x/big-smile/svg?seed=".concat(e)),"Fun Emoji":["Happy","Cool","Chill","Zen","Fire","Sparkle","Wave","Star","Moon","Rain","Snow","Thunder"].map(e=>"https://api.dicebear.com/7.x/fun-emoji/svg?seed=".concat(e)),Thumbs:["Alpha","Bravo","Charlie","Delta","Echo","Foxtrot","Golf","Hotel","India","Juliet","Kilo","Lima"].map(e=>"https://api.dicebear.com/7.x/thumbs/svg?seed=".concat(e)),Bottts:["Robo1","Mech","Droid","Bolt","Gear","Chip","Wire","Core","Node","Byte","Data","Grid"].map(e=>"https://api.dicebear.com/7.x/bottts/svg?seed=".concat(e)),Shapes:["Ruby","Emerald","Sapphire","Diamond","Topaz","Amethyst","Pearl","Garnet","Citrine","Peridot","Tanzanite","Aqua"].map(e=>"https://api.dicebear.com/7.x/shapes/svg?seed=".concat(e))};async function le(e){const{data:t}=await o.N.from("profiles").select("*").eq("id",e).maybeSingle();return t}async function de(){var e,t;const{data:{user:r}}=await o.N.auth.getUser();if(!r)return null;const{data:n}=await o.N.from("profiles").select("*").eq("id",r.id).maybeSingle();if(n)return n;const a=(null===(e=r.user_metadata)||void 0===e?void 0:e.username)||(null===(t=r.email)||void 0===t?void 0:t.split("@")[0])||"user",{data:i,error:s}=await o.N.from("profiles").upsert({id:r.id,username:a},{onConflict:"id"}).select().single();return s?(console.error("Auto-create profile failed:",s),null):i}async function ue(e){const{data:{user:t}}=await o.N.auth.getUser();if(!t)throw new Error("Not logged in");const{data:r,error:a}=await o.N.from("profiles").upsert((0,n.A)((0,n.A)({id:t.id},e),{},{updated_at:(new Date).toISOString()}),{onConflict:"id"}).select().single();if(a)throw a;return r}async function me(e){const{data:{user:t}}=await o.N.auth.getUser(),{data:r}=await o.N.from("profiles").select("*").ilike("username","%".concat(e,"%")).limit(20);return(r||[]).filter(e=>e.id!==(null===t||void 0===t?void 0:t.id))}async function ge(e){const{data:{user:t}}=await o.N.auth.getUser();if(!t)throw new Error("Not logged in");const{error:r}=await o.N.from("follows").insert({follower_id:t.id,following_id:e});if(r)throw r;const n=await le(e);await _e({action:"followed",title:(null===n||void 0===n?void 0:n.username)||"someone"})}async function ye(e){const{data:{user:t}}=await o.N.auth.getUser();if(!t)throw new Error("Not logged in");const{error:r}=await o.N.from("follows").delete().eq("follower_id",t.id).eq("following_id",e);if(r)throw r}async function fe(e){const{data:t}=await o.N.from("follows").select("following_id, profiles!follows_following_id_fkey(*)").eq("follower_id",e);return(t||[]).map(e=>e.profiles).filter(Boolean)}async function ve(e){const{data:t}=await o.N.from("follows").select("follower_id, profiles!follows_follower_id_fkey(*)").eq("following_id",e);return(t||[]).map(e=>e.profiles).filter(Boolean)}async function he(e){const{data:{user:t}}=await o.N.auth.getUser();if(!t)return!1;const{data:r}=await o.N.from("follows").select("id").eq("follower_id",t.id).eq("following_id",e).maybeSingle();return!!r}async function _e(e){const{data:{user:t}}=await o.N.auth.getUser();t&&await o.N.from("activity").insert((0,n.A)({user_id:t.id},e)).select()}async function pe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;const{data:{user:t}}=await o.N.auth.getUser();if(!t)return[];const{data:r}=await o.N.from("follows").select("following_id").eq("follower_id",t.id),n=(r||[]).map(e=>e.following_id);if(0===n.length)return[];const{data:a}=await o.N.from("activity").select("*, profiles!activity_user_id_fkey(username, avatar_url)").in("user_id",n).order("created_at",{ascending:!1}).limit(e);return a||[]}async function we(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;const{data:{user:t}}=await o.N.auth.getUser();if(!t)return[];const{data:r}=await o.N.from("activity").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(e);return r||[]}async function be(e){const{data:{user:t}}=await o.N.auth.getUser();if(!t)return null;const[r,n]=await Promise.all([o.N.from("library").select("*").eq("user_id",t.id).then(e=>e.data||[]),o.N.from("library").select("*").eq("user_id",e).then(e=>e.data||[])]),a=new Set(r.map(e=>e.tmdb_id||e.openlibrary_key).filter(Boolean)),i=n.filter(e=>a.has(e.tmdb_id||e.openlibrary_key)),s={};r.forEach(e=>(e.genres||"").split(",").forEach(e=>{const t=e.trim();t&&(s[t]=(s[t]||0)+1)}));const c={};n.forEach(e=>(e.genres||"").split(",").forEach(e=>{const t=e.trim();t&&(c[t]=(c[t]||0)+1)}));const l=Object.keys(s).filter(e=>c[e]).map(e=>({genre:e,overlap:Math.min(s[e],c[e])})).sort((e,t)=>t.overlap-e.overlap).slice(0,5),d=Math.max(r.length,n.length,1),u=Math.min(100,Math.round(i.length/d*100+5*l.length));let m=[];if(l.length>0){const e={Action:28,Comedy:35,Drama:18,Horror:27,Romance:10749,Thriller:53,"Sci-Fi":878,Animation:16,Crime:80,Documentary:99,Adventure:12,Fantasy:14,Mystery:9648,"Science Fiction":878}[l[0].genre];if(e){const t=await R(e),o=new Set([...r,...n].map(e=>e.tmdb_id).filter(Boolean));m=t.filter(e=>!o.has(e.id)).slice(0,10)}}return{shared:i,sharedGenres:l,compatibility:u,blendRecs:m,myCount:r.length,friendCount:n.length}}async function ke(){const{data:{user:e}}=await o.N.auth.getUser();if(!e)return[];const t=await Y();if(t.length<3)return[];const r=[...t].sort((e,t)=>(t.user_rating||t.external_rating||0)-(e.user_rating||e.external_rating||0)).slice(0,5).filter(e=>e.tmdb_id);if(0===r.length)return[];const a=await Promise.all(r.map(async e=>{try{const t="tv"===e.media_type?"tv":"movie";return((await w("/".concat(t,"/").concat(e.tmdb_id,"/recommendations"))).results||[]).map(e=>(0,n.A)((0,n.A)({},e),{},{media_type:t}))}catch(t){return[]}})),i=new Set(t.map(e=>String(e.tmdb_id))),s=new Set,c=a.flat().filter(e=>{const t="".concat(e.media_type,"-").concat(e.id);return!s.has(t)&&!i.has(String(e.id))&&(s.add(t),!0)});return c.sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)),c.slice(0,20)}async function Ne(e){const{data:t}=await o.N.from("library").select("*").eq("user_id",e).order("added_at",{ascending:!1});return t||[]}},3944(e,t,r){r.d(t,{A:()=>n});const n=(0,r(1212).A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])}}]);
//# sourceMappingURL=280.3c597c7c.chunk.js.map