{"version":3,"file":"static/js/280.3c597c7c.chunk.js","mappings":"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","sources":["services/api.js","../node_modules/lucide-react/src/icons/star.ts"],"sourcesContent":["import { supabase } from './supabase';\n\nconst TMDB_BASE = 'https://api.themoviedb.org/3';\nconst TMDB_KEY = process.env.REACT_APP_TMDB_API_KEY;\nconst OMDB_KEY = process.env.REACT_APP_OMDB_API_KEY || '4a3b711b';\nconst OL_BASE = 'https://openlibrary.org';\n\n// ─── In-memory cache (5-minute TTL) ───\nconst cache = new Map();\nconst CACHE_TTL = 5 * 60 * 1000;\n\nfunction cached(key, fetcher) {\n  const entry = cache.get(key);\n  if (entry && Date.now() - entry.ts < CACHE_TTL) return Promise.resolve(entry.data);\n  return fetcher().then(data => {\n    cache.set(key, { data, ts: Date.now() });\n    return data;\n  });\n}\n\n// ─── Persistent Syllabus Score store (localStorage) ───\n// Scores never expire — movie ratings are stable.\n// Key format: \"movie:123\" or \"tv:456\" → score (number)\nconst SCORE_STORE_KEY = 'syllabus_scores';\nconst OMDB_STORE_KEY = 'syllabus_omdb';\n\nlet _scoreCache = null;\nfunction getScoreStore() {\n  if (!_scoreCache) {\n    try { _scoreCache = JSON.parse(localStorage.getItem(SCORE_STORE_KEY) || '{}'); }\n    catch { _scoreCache = {}; }\n  }\n  return _scoreCache;\n}\n\nfunction _saveScoreStore() {\n  try { localStorage.setItem(SCORE_STORE_KEY, JSON.stringify(_scoreCache)); } catch { /* quota */ }\n}\n\nexport function getSyllabusScore(mediaType, id) {\n  return getScoreStore()[`${mediaType}:${id}`] ?? null;\n}\n\nexport function setSyllabusScore(mediaType, id, score) {\n  if (score == null || !id) return;\n  const store = getScoreStore();\n  store[`${mediaType}:${id}`] = score;\n  _saveScoreStore();\n}\n\n// Batch apply stored scores to an array of items\nexport function applyStoredScores(items, mediaType) {\n  const store = getScoreStore();\n  items.forEach(item => {\n    const key = `${mediaType}:${item.id}`;\n    if (store[key] != null) {\n      item.unified_rating = store[key];\n    }\n  });\n  return items;\n}\n\n// ─── Persistent OMDb cache (localStorage) ───\nlet _omdbCache = null;\nfunction getOmdbStore() {\n  if (!_omdbCache) {\n    try {\n      _omdbCache = JSON.parse(localStorage.getItem(OMDB_STORE_KEY) || '{}');\n      // Purge null entries (stale rate-limit failures) so they can be re-fetched\n      let purged = false;\n      for (const k of Object.keys(_omdbCache)) {\n        if (_omdbCache[k] === null) { delete _omdbCache[k]; purged = true; }\n      }\n      if (purged) {\n        try { localStorage.setItem(OMDB_STORE_KEY, JSON.stringify(_omdbCache)); } catch { /* quota */ }\n      }\n    }\n    catch { _omdbCache = {}; }\n  }\n  return _omdbCache;\n}\n\nfunction saveOmdbEntry(key, data) {\n  const store = getOmdbStore();\n  store[key] = data;\n  try { localStorage.setItem(OMDB_STORE_KEY, JSON.stringify(store)); } catch { /* quota */ }\n}\n\nfunction getOmdbEntry(key) {\n  return getOmdbStore()[key] ?? undefined;\n}\n\n// ─── TMDB helper ───\nasync function tmdb(endpoint, params = '') {\n  const res = await fetch(`${TMDB_BASE}${endpoint}?api_key=${TMDB_KEY}${params}`);\n  return res.json();\n}\n\nfunction tmdbCached(endpoint, params = '') {\n  return cached(`tmdb:${endpoint}${params}`, () => tmdb(endpoint, params));\n}\n\n// ─── Movies ───\n\nexport function getTrendingMovies() {\n  return tmdbCached('/trending/movie/week').then(d => d.results || []);\n}\n\nexport function getUpcomingMovies() {\n  return tmdbCached('/movie/upcoming').then(d => d.results || []);\n}\n\nexport async function searchMovies(query) {\n  const data = await tmdb('/search/movie', `&query=${encodeURIComponent(query)}`);\n  return data.results || [];\n}\n\nexport function getMovieDetails(id) {\n  return tmdbCached(`/movie/${id}`, '&append_to_response=recommendations,credits,watch/providers,external_ids,videos');\n}\n\n// ─── TV Shows ───\n\nexport function getTrendingTV() {\n  return tmdbCached('/trending/tv/week').then(d => d.results || []);\n}\n\nexport function getAiringTV() {\n  return tmdbCached('/tv/airing_today').then(d => d.results || []);\n}\n\nexport async function searchTV(query) {\n  const data = await tmdb('/search/tv', `&query=${encodeURIComponent(query)}`);\n  return data.results || [];\n}\n\nexport function getTVDetails(id) {\n  return tmdbCached(`/tv/${id}`, '&append_to_response=recommendations,credits,watch/providers,external_ids,videos');\n}\n\n// ─── Movie Discovery ───\n\nexport function getTopRatedMovies() {\n  return tmdbCached('/movie/top_rated').then(d => d.results || []);\n}\n\nexport function getNowPlayingMovies() {\n  return tmdbCached('/movie/now_playing').then(d => d.results || []);\n}\n\nexport function getPopularMovies() {\n  return tmdbCached('/movie/popular').then(d => d.results || []);\n}\n\nexport function getMoviesByGenre(genreId) {\n  return tmdbCached('/discover/movie', `&with_genres=${genreId}&sort_by=popularity.desc&vote_count.gte=50`).then(d => d.results || []);\n}\n\n// ─── TV Discovery ───\n\nexport function getTopRatedTV() {\n  return tmdbCached('/tv/top_rated').then(d => d.results || []);\n}\n\nexport function getPopularTV() {\n  return tmdbCached('/tv/popular').then(d => d.results || []);\n}\n\nexport function getTVByGenre(genreId) {\n  return tmdbCached('/discover/tv', `&with_genres=${genreId}&sort_by=popularity.desc&vote_count.gte=50`).then(d => d.results || []);\n}\n\nexport function getAnime() {\n  return tmdbCached('/discover/tv', '&with_genres=16&with_original_language=ja&sort_by=popularity.desc&vote_count.gte=50').then(d => d.results || []);\n}\n\nexport function getAnimationTV() {\n  return tmdbCached('/discover/tv', '&with_genres=16&without_original_language=ja&sort_by=popularity.desc&vote_count.gte=20').then(d => d.results || []);\n}\n\n// ─── Top 100 (TMDB — 5 pages × 20 = 100) ───\n\nexport function getTop100Movies(genreId = null) {\n  const key = genreId ? `top100:movies:${genreId}` : 'top100:movies';\n  return cached(key, async () => {\n    if (genreId) {\n      const pages = await Promise.all(\n        [1, 2, 3, 4, 5].map(p => tmdb('/discover/movie', `&sort_by=vote_average.desc&vote_count.gte=1000&with_genres=${genreId}&page=${p}`))\n      );\n      const seen = new Set();\n      return pages.flatMap(p => p.results || []).filter(m => { if (seen.has(m.id)) return false; seen.add(m.id); return true; });\n    }\n    const pages = await Promise.all(\n      [1, 2, 3, 4, 5].map(p => tmdb('/movie/top_rated', `&page=${p}`))\n    );\n    return pages.flatMap(p => p.results || []);\n  });\n}\n\nexport function getTop100TV(genreId = null) {\n  const key = genreId ? `top100:tv:${genreId}` : 'top100:tv';\n  return cached(key, async () => {\n    if (genreId) {\n      const pages = await Promise.all(\n        [1, 2, 3, 4, 5].map(p => tmdb('/discover/tv', `&sort_by=vote_average.desc&vote_count.gte=500&with_genres=${genreId}&page=${p}`))\n      );\n      const seen = new Set();\n      return pages.flatMap(p => p.results || []).filter(s => { if (seen.has(s.id)) return false; seen.add(s.id); return true; });\n    }\n    const pages = await Promise.all(\n      [1, 2, 3, 4, 5].map(p => tmdb('/tv/top_rated', `&page=${p}`))\n    );\n    return pages.flatMap(p => p.results || []);\n  });\n}\n\n// ─── OMDb (IMDb + Rotten Tomatoes + Metacritic) ───\n\nfunction parseOMDbResponse(data) {\n  if (!data || data.Response === 'False') return null;\n  const ratings = { imdb_id: data.imdbID };\n  (data.Ratings || []).forEach(r => {\n    if (r.Source === 'Internet Movie Database') {\n      ratings.imdb = { score: r.Value, votes: data.imdbVotes };\n    } else if (r.Source === 'Rotten Tomatoes') {\n      ratings.rt = { score: r.Value };\n    } else if (r.Source === 'Metacritic') {\n      ratings.metacritic = { score: r.Value };\n    }\n  });\n  if (data.Director && data.Director !== 'N/A') ratings.director = data.Director;\n  if (data.Writer && data.Writer !== 'N/A') ratings.writer = data.Writer;\n  if (data.Awards && data.Awards !== 'N/A') ratings.awards = data.Awards;\n  if (data.BoxOffice && data.BoxOffice !== 'N/A') ratings.boxOffice = data.BoxOffice;\n  if (data.Rated && data.Rated !== 'N/A') ratings.rated = data.Rated;\n  if (data.Country && data.Country !== 'N/A') ratings.country = data.Country;\n  return ratings;\n}\n\nexport function getOMDbRatings(imdbId, title = null, type = null) {\n  if (!imdbId) return Promise.resolve(null);\n  // Check persistent localStorage cache first\n  const storedKey = `i:${imdbId}`;\n  const stored = getOmdbEntry(storedKey);\n  if (stored !== undefined) return Promise.resolve(stored);\n\n  return cached(`omdb:${imdbId}`, async () => {\n    try {\n      const res = await fetch(`https://www.omdbapi.com/?i=${imdbId}&apikey=${OMDB_KEY}`);\n      const data = await res.json();\n      // Don't cache rate-limit errors — they're transient\n      if (data.Error === 'Request limit reached!') return null;\n      const ratings = parseOMDbResponse(data);\n      if (!ratings) { saveOmdbEntry(storedKey, null); return null; }\n\n      // If no RT score and we have a title, try searching by title as fallback\n      if (!ratings.rt && title) {\n        const omdbType = type === 'tv' ? 'series' : type === 'movie' ? 'movie' : '';\n        let url = `https://www.omdbapi.com/?t=${encodeURIComponent(title)}&apikey=${OMDB_KEY}`;\n        if (omdbType) url += `&type=${omdbType}`;\n        const fallbackRes = await fetch(url);\n        const fallbackData = await fallbackRes.json();\n        if (fallbackData.Response !== 'False') {\n          (fallbackData.Ratings || []).forEach(r => {\n            if (r.Source === 'Rotten Tomatoes' && !ratings.rt) {\n              ratings.rt = { score: r.Value };\n            }\n          });\n        }\n      }\n\n      saveOmdbEntry(storedKey, ratings);\n      return ratings;\n    } catch { return null; }\n  });\n}\n\n// ─── OMDb by title (used for Top 100 enrichment where we lack IMDb IDs) ───\n\nexport function getOMDbByTitle(title, year, type = 'movie') {\n  if (!title) return Promise.resolve(null);\n  const omdbType = type === 'tv' ? 'series' : 'movie';\n  const storedKey = `t:${title}:${year || ''}:${omdbType}`;\n  const stored = getOmdbEntry(storedKey);\n  if (stored !== undefined) return Promise.resolve(stored);\n\n  return cached(`omdb:t:${title}:${year || ''}:${omdbType}`, async () => {\n    try {\n      let url = `https://www.omdbapi.com/?t=${encodeURIComponent(title)}&type=${omdbType}&apikey=${OMDB_KEY}`;\n      if (year) url += `&y=${year}`;\n      const res = await fetch(url);\n      const data = await res.json();\n      const result = parseOMDbResponse(data);\n      saveOmdbEntry(storedKey, result);\n      return result;\n    } catch { return null; }\n  });\n}\n\n// ─── Unified Rating: avg(IMDb, RT/10) or avg(IMDb, MAL) for anime ───\n// Returns a single /10 score or null if no data at all\n\nexport function computeUnifiedRating(omdbData, malData, isAnime) {\n  const scores = [];\n  if (omdbData?.imdb?.score) {\n    const v = parseFloat(omdbData.imdb.score);\n    if (!isNaN(v)) scores.push(v);\n  }\n  if (isAnime) {\n    if (malData?.score) scores.push(malData.score);\n  } else {\n    if (omdbData?.rt?.score) {\n      const v = parseInt(omdbData.rt.score);\n      if (!isNaN(v)) scores.push(v / 10);\n    }\n  }\n  if (scores.length === 0) return null;\n  return parseFloat((scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1));\n}\n\n// ─── Batch enrich items with unified ratings (for Top 100) ───\n\nexport function enrichItemsWithRatings(items, mediaType) {\n  const key = `enriched:${mediaType}:${items.map(i => i.id || i.key).join(',')}`;\n  return cached(key, async () => {\n    const enriched = items.map(i => ({ ...i }));\n    const scoreStore = getScoreStore();\n    const batchSize = 10;\n\n    // First pass: apply any stored scores (instant — no API calls)\n    const needsFetch = [];\n    enriched.forEach(item => {\n      const storeKey = `${mediaType}:${item.id}`;\n      if (scoreStore[storeKey] != null) {\n        item.unified_rating = scoreStore[storeKey];\n      } else {\n        needsFetch.push(item);\n      }\n    });\n\n    // Second pass: fetch OMDb only for items without stored scores\n    for (let i = 0; i < needsFetch.length; i += batchSize) {\n      const batch = needsFetch.slice(i, i + batchSize);\n      await Promise.all(batch.map(async (item) => {\n        const title = item.title || item.name;\n        const year = (item.release_date || item.first_air_date || '').slice(0, 4);\n        const isAnime = item.original_language === 'ja' &&\n          (item.genre_ids?.includes(16) || item.genres?.some(g => g.id === 16));\n\n        const omdb = await getOMDbByTitle(title, year, mediaType);\n        let mal = null;\n        if (isAnime) {\n          try { mal = await getMALRating(title); } catch { /* ignore */ }\n        }\n\n        item.unified_rating = computeUnifiedRating(omdb, mal, isAnime);\n        // Persist the score for future instant lookups\n        if (item.unified_rating != null) {\n          setSyllabusScore(mediaType, item.id, item.unified_rating);\n        }\n      }));\n    }\n\n    // Sort by unified rating (fallback to vote_average/rating)\n    enriched.sort((a, b) => {\n      const ra = a.unified_rating ?? a.vote_average ?? a.rating ?? 0;\n      const rb = b.unified_rating ?? b.vote_average ?? b.rating ?? 0;\n      return rb - ra;\n    });\n\n    return enriched;\n  });\n}\n\n// ─── MAL / Jikan (Anime ratings) ───\n\nexport function getMALRating(title) {\n  if (!title) return Promise.resolve(null);\n  return cached(`mal:${title}`, async () => {\n    try {\n      const res = await fetch(`https://api.jikan.moe/v4/anime?q=${encodeURIComponent(title)}&limit=1`);\n      const data = await res.json();\n      const anime = data.data?.[0];\n      if (!anime) return null;\n      return {\n        score: anime.score,\n        scored_by: anime.scored_by,\n        mal_id: anime.mal_id,\n        url: anime.url,\n      };\n    } catch { return null; }\n  });\n}\n\n// ─── Books (Open Library — free, unlimited, reliable) ───\n\nfunction mapOLWork(w) {\n  const coverId = w.cover_i || w.cover_id;\n  return {\n    key: w.key,\n    title: w.title,\n    author: w.author_name?.[0] || w.authors?.[0]?.name || 'Unknown',\n    cover_id: coverId,\n    poster_path: coverId\n      ? `https://covers.openlibrary.org/b/id/${coverId}-L.jpg`\n      : null,\n    first_publish_year: w.first_publish_year,\n    rating: w.ratings_average ? Math.round(w.ratings_average * 20) / 10 : null,\n    ratings_count: w.ratings_count || 0,\n    want_to_read: w.want_to_read_count || 0,\n    already_read: w.already_read_count || 0,\n    currently_reading: w.currently_reading_count || 0,\n    edition_count: w.edition_count || 0,\n    subject: w.subject?.slice(0, 5) || [],\n    media_type: 'book',\n  };\n}\n\nexport function getTrendingBooks() {\n  return cached('ol:trending', async () => {\n    try {\n      const res = await fetch(`${OL_BASE}/trending/daily.json?limit=20`);\n      const data = await res.json();\n      return (data.works || []).map(mapOLWork);\n    } catch { return []; }\n  });\n}\n\nexport function getBooksBySubject(subject) {\n  return cached(`ol:subject:${subject}`, async () => {\n    try {\n      const res = await fetch(`${OL_BASE}/subjects/${encodeURIComponent(subject)}.json?limit=20`);\n      const data = await res.json();\n      return (data.works || []).map(w => ({\n        key: w.key,\n        title: w.title,\n        author: w.authors?.[0]?.name || 'Unknown',\n        cover_id: w.cover_id,\n        poster_path: w.cover_id\n          ? `https://covers.openlibrary.org/b/id/${w.cover_id}-L.jpg`\n          : null,\n        first_publish_year: w.first_publish_year,\n        rating: null,\n        subject: [subject],\n        media_type: 'book',\n      }));\n    } catch { return []; }\n  });\n}\n\nexport async function searchBooks(query) {\n  try {\n    const res = await fetch(`${OL_BASE}/search.json?q=${encodeURIComponent(query)}&limit=20&fields=key,title,author_name,cover_i,first_publish_year,ratings_average,ratings_count,want_to_read_count,already_read_count,currently_reading_count,edition_count,subject`);\n    const data = await res.json();\n    return (data.docs || []).map(mapOLWork);\n  } catch { return []; }\n}\n\n// ─── Book Detail (Open Library work + ratings + bookshelves + editions) ───\n\nexport function getBookDetails(workKey) {\n  const key = workKey.startsWith('/works/') ? workKey : `/works/${workKey}`;\n  return cached(`ol:detail:${key}`, async () => {\n    try {\n      const [work, ratings, shelves, editions] = await Promise.all([\n        fetch(`${OL_BASE}${key}.json`).then(r => r.json()),\n        fetch(`${OL_BASE}${key}/ratings.json`).then(r => r.json()).catch(() => null),\n        fetch(`${OL_BASE}${key}/bookshelves.json`).then(r => r.json()).catch(() => null),\n        fetch(`${OL_BASE}${key}/editions.json?limit=1`).then(r => r.json()).catch(() => null),\n      ]);\n\n      // Resolve authors\n      let authors = [];\n      if (work.authors && work.authors.length > 0) {\n        const authorKeys = work.authors\n          .map(a => a.author?.key || a.key)\n          .filter(Boolean);\n        const authorResults = await Promise.all(\n          authorKeys.slice(0, 5).map(aKey =>\n            fetch(`${OL_BASE}${aKey}.json`).then(r => r.json()).catch(() => null)\n          )\n        );\n        authors = authorResults.filter(Boolean).map(a => ({\n          name: a.name || a.personal_name || 'Unknown',\n          key: a.key,\n          photo: a.photos?.[0] ? `https://covers.openlibrary.org/a/id/${a.photos[0]}-M.jpg` : null,\n          bio: typeof a.bio === 'string' ? a.bio : a.bio?.value || '',\n        }));\n      }\n\n      const coverId = work.covers?.[0];\n      const desc = typeof work.description === 'string' ? work.description : work.description?.value || '';\n      return {\n        key: work.key,\n        title: work.title,\n        description: desc,\n        cover_id: coverId,\n        poster_path: coverId ? `https://covers.openlibrary.org/b/id/${coverId}-L.jpg` : null,\n        first_publish_date: work.first_publish_date || '',\n        subjects: (work.subjects || []).slice(0, 8),\n        rating: ratings?.summary?.average ? Math.round(ratings.summary.average * 20) / 10 : null,\n        ratings_count: ratings?.summary?.count || 0,\n        want_to_read: shelves?.counts?.want_to_read || 0,\n        currently_reading: shelves?.counts?.currently_reading || 0,\n        already_read: shelves?.counts?.already_read || 0,\n        edition_count: editions?.size || editions?.entries?.length || 0,\n        authors,\n        media_type: 'book',\n      };\n    } catch { return null; }\n  });\n}\n\n// ─── Top 100 Books (by rating, filtered by min votes) ───\n\nexport function getTop100Books(subject = null) {\n  const key = subject ? `top100:books:${subject}` : 'top100:books';\n  return cached(key, async () => {\n    try {\n      const q = subject ? `subject:${subject}` : 'subject:fiction OR subject:literature';\n      const res = await fetch(`${OL_BASE}/search.json?q=${encodeURIComponent(q)}&sort=rating&limit=100&fields=key,title,author_name,cover_i,first_publish_year,ratings_average,ratings_count,want_to_read_count,already_read_count,currently_reading_count,edition_count,subject`);\n      const data = await res.json();\n      return (data.docs || []).filter(d => (d.ratings_count || 0) >= 10).map(mapOLWork);\n    } catch { return []; }\n  });\n}\n\n// ─── Multi-search ───\n\nexport async function multiSearch(query) {\n  const [tmdbData, booksRes] = await Promise.all([\n    tmdb('/search/multi', `&query=${encodeURIComponent(query)}`),\n    fetch(`${OL_BASE}/search.json?q=${encodeURIComponent(query)}&limit=5&fields=key,title,author_name,cover_i,first_publish_year`)\n      .then(r => r.json()).catch(() => ({ docs: [] })),\n  ]);\n\n  const media = (tmdbData.results || []).filter(r => r.media_type === 'movie' || r.media_type === 'tv');\n  const books = (booksRes.docs || []).slice(0, 5).map(mapOLWork);\n\n  return [...media, ...books];\n}\n\n// ─── Library (Supabase) ───\n\nexport async function getLibrary(filters = {}) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  let query = supabase.from('library').select('*').eq('user_id', user.id).order('added_at', { ascending: false });\n  if (filters.media_type) query = query.eq('media_type', filters.media_type);\n  if (filters.status) query = query.eq('status', filters.status);\n  const { data, error } = await query;\n  if (error) throw error;\n  return data || [];\n}\n\nexport async function addToLibrary(item) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n\n  // ─ Duplicate check ─\n  let dupeQuery = supabase.from('library').select('id').eq('user_id', user.id);\n  if (item.tmdb_id) dupeQuery = dupeQuery.eq('tmdb_id', item.tmdb_id);\n  else if (item.openlibrary_key) dupeQuery = dupeQuery.eq('openlibrary_key', item.openlibrary_key);\n  const { data: existing } = await dupeQuery;\n  if (existing && existing.length > 0) throw new Error('Already in your library');\n\n  const { data, error } = await supabase.from('library').insert({\n    user_id: user.id,\n    status: 'watching',\n    ...item,\n  }).select().single();\n  if (error) throw error;\n  return data;\n}\n\nexport async function updateLibraryItem(id, updates) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  // Use maybeSingle so a 0-row result doesn't throw PGRST116\n  const { data, error } = await supabase.from('library')\n    .update({ ...updates, updated_at: new Date().toISOString() })\n    .eq('id', id)\n    .eq('user_id', user.id)\n    .select()\n    .maybeSingle();\n  if (error) throw new Error(error.message || 'Update failed');\n  if (!data) throw new Error('Item not found — it may have been removed');\n  return data;\n}\n\nexport async function removeFromLibrary(id) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  const { error } = await supabase.from('library').delete().eq('id', id).eq('user_id', user.id);\n  if (error) throw error;\n}\n\n// Look up a library item by tmdb_id or openlibrary_key for the current user\nexport async function getLibraryItemByMediaId({ tmdb_id, openlibrary_key }) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return null;\n  let query = supabase.from('library').select('*').eq('user_id', user.id);\n  if (tmdb_id) query = query.eq('tmdb_id', tmdb_id);\n  else if (openlibrary_key) query = query.eq('openlibrary_key', openlibrary_key);\n  else return null;\n  const { data } = await query.maybeSingle();\n  return data || null;\n}\n\n// ─── Curated Picks (high quality, well-rated) ───\n\nconst GENRE_MAP = {\n  all: '',\n  action: '28', comedy: '35', drama: '18', scifi: '878',\n  thriller: '53', romance: '10749', horror: '27', animation: '16',\n  documentary: '99', crime: '80', fantasy: '14', family: '10751',\n};\n\nexport async function getCuratedPicks(genre = 'all', page = 1) {\n  const genreParam = GENRE_MAP[genre] ? `&with_genres=${GENRE_MAP[genre]}` : '';\n  const data = await tmdb('/discover/movie', `&sort_by=vote_average.desc&vote_count.gte=500&vote_average.gte=6${genreParam}&page=${page}`);\n  return data.results || [];\n}\n\n// ─── AI Scenario Search ───\n\nconst SCENARIO_KEYWORDS = {\n  'date night': { genres: '10749,35', keywords: '' },\n  'date': { genres: '10749,35', keywords: '' },\n  'romantic': { genres: '10749', keywords: '' },\n  'family': { genres: '10751,16', keywords: '' },\n  'kids': { genres: '10751,16', keywords: '' },\n  'children': { genres: '10751,16', keywords: '' },\n  'scary': { genres: '27', keywords: '' },\n  'horror': { genres: '27', keywords: '' },\n  'funny': { genres: '35', keywords: '' },\n  'laugh': { genres: '35', keywords: '' },\n  'comedy': { genres: '35', keywords: '' },\n  'cry': { genres: '18,10749', keywords: '' },\n  'emotional': { genres: '18,10749', keywords: '' },\n  'sad': { genres: '18', keywords: '' },\n  'action': { genres: '28', keywords: '' },\n  'adrenaline': { genres: '28,53', keywords: '' },\n  'escape': { genres: '14,12,878', keywords: '' },\n  'mind off': { genres: '28,12,35', keywords: '' },\n  'take my mind': { genres: '28,12,35,14', keywords: '' },\n  'relax': { genres: '35,10751,10402', keywords: '' },\n  'chill': { genres: '35,10402', keywords: '' },\n  'thriller': { genres: '53,9648', keywords: '' },\n  'suspense': { genres: '53,9648', keywords: '' },\n  'mystery': { genres: '9648', keywords: '' },\n  'mind bending': { genres: '878,9648', keywords: '' },\n  'trippy': { genres: '878,9648', keywords: '' },\n  'sci-fi': { genres: '878', keywords: '' },\n  'space': { genres: '878', keywords: '1612' },\n  'war': { genres: '10752,18', keywords: '' },\n  'history': { genres: '36', keywords: '' },\n  'true story': { genres: '18,36', keywords: '9672' },\n  'based on': { genres: '18', keywords: '9672' },\n  'superhero': { genres: '28,878', keywords: '9715' },\n  'animated': { genres: '16', keywords: '' },\n  'anime': { genres: '16', keywords: '' },\n  'documentary': { genres: '99', keywords: '' },\n  'learn': { genres: '99,36', keywords: '' },\n  'inspiring': { genres: '18', keywords: '9748' },\n  'motivat': { genres: '18', keywords: '9748' },\n  'adventure': { genres: '12,28', keywords: '' },\n  'fantasy': { genres: '14', keywords: '' },\n  'magic': { genres: '14', keywords: '' },\n  'zombie': { genres: '27', keywords: '12377' },\n  'survival': { genres: '28,53', keywords: '10349' },\n  'heist': { genres: '80,53', keywords: '10051' },\n  'feel good': { genres: '35,10751,10749', keywords: '' },\n  'wholesome': { genres: '35,10751', keywords: '' },\n  'coming of age': { genres: '18', keywords: '10683' },\n  'teen': { genres: '18,35', keywords: '10683' },\n  'western': { genres: '37', keywords: '' },\n  'music': { genres: '10402', keywords: '' },\n  'sport': { genres: '18', keywords: '6075' },\n  'revenge': { genres: '28,53', keywords: '10084' },\n};\n\nexport async function searchByScenario(query) {\n  const q = query.toLowerCase().trim();\n  let genres = '';\n  let keywords = '';\n\n  // Match scenario keywords (longest first for multi-word matches)\n  const sorted = Object.entries(SCENARIO_KEYWORDS).sort((a, b) => b[0].length - a[0].length);\n  for (const [phrase, config] of sorted) {\n    if (q.includes(phrase)) {\n      genres = config.genres;\n      keywords = config.keywords;\n      break;\n    }\n  }\n\n  if (!genres) {\n    // Fallback: TMDB keyword search\n    const kwRes = await tmdb('/search/keyword', `&query=${encodeURIComponent(q)}`);\n    const kwIds = (kwRes.results || []).slice(0, 3).map(k => k.id).join('|');\n    if (kwIds) {\n      const data = await tmdb('/discover/movie', `&with_keywords=${kwIds}&sort_by=vote_average.desc&vote_count.gte=100`);\n      return (data.results || []).map(r => ({ ...r, media_type: 'movie' }));\n    }\n    // Last resort: regular search\n    const data = await tmdb('/search/movie', `&query=${encodeURIComponent(query)}`);\n    return (data.results || []).map(r => ({ ...r, media_type: 'movie' }));\n  }\n\n  const kwParam = keywords ? `&with_keywords=${keywords}` : '';\n  const [movies, tv] = await Promise.all([\n    tmdb('/discover/movie', `&with_genres=${genres}${kwParam}&sort_by=vote_average.desc&vote_count.gte=200&page=${Math.floor(Math.random() * 3) + 1}`),\n    tmdb('/discover/tv', `&with_genres=${genres.replace('10752','10768').replace('10751','10751')}${kwParam}&sort_by=vote_average.desc&vote_count.gte=200&page=${Math.floor(Math.random() * 2) + 1}`),\n  ]);\n\n  const combined = [\n    ...(movies.results || []).map(r => ({ ...r, media_type: 'movie' })),\n    ...(tv.results || []).map(r => ({ ...r, media_type: 'tv' })),\n  ].sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0));\n\n  return combined.slice(0, 20);\n}\n\n// ─── TMDB Discover by Mood ───\n\nconst MOOD_GENRES = {\n  light: { movie: '35,10751,10402', tv: '35,10751' }, // Comedy, Family, Music\n  dark: { movie: '28,53,27,80', tv: '28,80,9648' }, // Action, Thriller, Horror, Crime\n  mind: { movie: '878,9648,14', tv: '878,9648' }, // Sci-Fi, Mystery, Fantasy\n  feel: { movie: '10749,18,10402', tv: '10749,18' }, // Romance, Drama, Music\n  adventure: { movie: '12,28,14', tv: '10759,14' }, // Adventure, Action, Fantasy\n  chill: { movie: '99,36,10770', tv: '99,10764' }, // Documentary, History, Reality\n};\n\nexport async function discoverByMood(mood, mediaType = 'movie') {\n  const genreStr = MOOD_GENRES[mood]?.[mediaType] || MOOD_GENRES.light[mediaType];\n  const endpoint = mediaType === 'movie' ? '/discover/movie' : '/discover/tv';\n  const data = await tmdb(endpoint, `&with_genres=${genreStr}&sort_by=vote_average.desc&vote_count.gte=200&page=${Math.floor(Math.random() * 3) + 1}`);\n  return data.results || [];\n}\n\n// ─── Smart Recommendations (based on library) ───\n\nexport async function getSmartRecommendations(libraryItems) {\n  if (!libraryItems || libraryItems.length === 0) return [];\n\n  // Find highest-rated finished items (prefer user_rating, fallback to external)\n  const rated = libraryItems\n    .filter(i => i.status === 'finished' && i.media_type !== 'book')\n    .sort((a, b) => (b.user_rating || b.external_rating || 0) - (a.user_rating || a.external_rating || 0))\n    .slice(0, 5);\n\n  // Also include items being watched\n  const watching = libraryItems\n    .filter(i => i.status === 'watching' && i.media_type !== 'book')\n    .slice(0, 3);\n\n  const seeds = [...rated, ...watching].slice(0, 6);\n  if (seeds.length === 0) return [];\n\n  // Fetch TMDB recommendations for each seed\n  const allRecs = await Promise.all(\n    seeds.map(async (item) => {\n      try {\n        const endpoint = item.media_type === 'tv' ? `/tv/${item.tmdb_id}` : `/movie/${item.tmdb_id}`;\n        const data = await tmdb(endpoint, '&append_to_response=recommendations');\n        return (data.recommendations?.results || []).map(r => ({\n          ...r,\n          media_type: r.media_type || item.media_type,\n          _source: item.title,\n          _sourceRating: item.user_rating || item.external_rating || 0,\n        }));\n      } catch { return []; }\n    })\n  );\n\n  // Flatten, deduplicate, remove items already in library\n  const libraryIds = new Set(libraryItems.map(i => String(i.tmdb_id)));\n  const seen = new Set();\n  const unique = allRecs.flat().filter(r => {\n    const key = `${r.media_type}-${r.id}`;\n    if (seen.has(key) || libraryIds.has(String(r.id))) return false;\n    seen.add(key);\n    return true;\n  });\n\n  // Score: TMDB rating + bonus for coming from highly-rated seeds\n  unique.sort((a, b) => {\n    const scoreA = (a.vote_average || 0) + (a._sourceRating / 10);\n    const scoreB = (b.vote_average || 0) + (b._sourceRating / 10);\n    return scoreB - scoreA;\n  });\n\n  return unique.slice(0, 20);\n}\n\n// ═══════════════════════════════════════════════════════\n//  SOCIAL: Profiles, Follows, Activity, Blends\n// ═══════════════════════════════════════════════════════\n\n// Preset avatar options — diverse styles via DiceBear API\nexport const AVATAR_PRESETS = {\n  'Adventurer': [\n    'Neo', 'Trinity', 'Ripley', 'Goku', 'Totoro', 'Yoda',\n    'Athena', 'Zephyr', 'Cosmo', 'Pixel', 'Blaze', 'Orbit',\n  ].map(s => `https://api.dicebear.com/7.x/adventurer/svg?seed=${s}`),\n\n  'Portraits': [\n    'Sora', 'Luna', 'Kai', 'Ember', 'Storm', 'Phoenix',\n    'Aurora', 'Vesper', 'Cleo', 'Nyx', 'Zenith', 'Opal',\n  ].map(s => `https://api.dicebear.com/7.x/lorelei/svg?seed=${s}`),\n\n  'Personas': [\n    'Hero', 'Villain', 'Sage', 'Rebel', 'Ghost', 'Ninja',\n    'Druid', 'Rogue', 'Titan', 'Oracle', 'Drift', 'Hex',\n  ].map(s => `https://api.dicebear.com/7.x/personas/svg?seed=${s}`),\n\n  'Minimal': [\n    'Ace', 'Maverick', 'Raven', 'Atlas', 'Echo', 'Cipher',\n    'Nova', 'Flux', 'Prism', 'Quasar', 'Onyx', 'Aero',\n  ].map(s => `https://api.dicebear.com/7.x/notionists/svg?seed=${s}`),\n\n  'Pixel Art': [\n    'Mario', 'Zelda', 'Link', 'Samus', 'Kirby', 'Fox',\n    'Pikachu', 'Cloud', 'Sonic', 'Megaman', 'Pac', 'Snake',\n  ].map(s => `https://api.dicebear.com/7.x/pixel-art/svg?seed=${s}`),\n\n  'Big Smile': [\n    'Joy', 'Sunny', 'Breeze', 'Coral', 'Daisy', 'Mint',\n    'Fern', 'Copper', 'Sienna', 'Jade', 'Willow', 'Ivy',\n  ].map(s => `https://api.dicebear.com/7.x/big-smile/svg?seed=${s}`),\n\n  'Fun Emoji': [\n    'Happy', 'Cool', 'Chill', 'Zen', 'Fire', 'Sparkle',\n    'Wave', 'Star', 'Moon', 'Rain', 'Snow', 'Thunder',\n  ].map(s => `https://api.dicebear.com/7.x/fun-emoji/svg?seed=${s}`),\n\n  'Thumbs': [\n    'Alpha', 'Bravo', 'Charlie', 'Delta', 'Echo', 'Foxtrot',\n    'Golf', 'Hotel', 'India', 'Juliet', 'Kilo', 'Lima',\n  ].map(s => `https://api.dicebear.com/7.x/thumbs/svg?seed=${s}`),\n\n  'Bottts': [\n    'Robo1', 'Mech', 'Droid', 'Bolt', 'Gear', 'Chip',\n    'Wire', 'Core', 'Node', 'Byte', 'Data', 'Grid',\n  ].map(s => `https://api.dicebear.com/7.x/bottts/svg?seed=${s}`),\n\n  'Shapes': [\n    'Ruby', 'Emerald', 'Sapphire', 'Diamond', 'Topaz', 'Amethyst',\n    'Pearl', 'Garnet', 'Citrine', 'Peridot', 'Tanzanite', 'Aqua',\n  ].map(s => `https://api.dicebear.com/7.x/shapes/svg?seed=${s}`),\n};\n\n// ─── Profiles ───\n\nexport async function getProfile(userId) {\n  const { data } = await supabase.from('profiles').select('*').eq('id', userId).maybeSingle();\n  return data;\n}\n\nexport async function getMyProfile() {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return null;\n  const { data } = await supabase.from('profiles').select('*').eq('id', user.id).maybeSingle();\n  if (data) return data;\n  // Auto-create profile row if it doesn't exist yet\n  const username = user.user_metadata?.username || user.email?.split('@')[0] || 'user';\n  const { data: created, error } = await supabase.from('profiles')\n    .upsert({ id: user.id, username }, { onConflict: 'id' })\n    .select()\n    .single();\n  if (error) { console.error('Auto-create profile failed:', error); return null; }\n  return created;\n}\n\nexport async function updateProfile(updates) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  const { data, error } = await supabase.from('profiles')\n    .upsert({ id: user.id, ...updates, updated_at: new Date().toISOString() }, { onConflict: 'id' })\n    .select()\n    .single();\n  if (error) throw error;\n  return data;\n}\n\nexport async function searchUsers(query) {\n  const { data: { user } } = await supabase.auth.getUser();\n  const { data } = await supabase.from('profiles')\n    .select('*')\n    .ilike('username', `%${query}%`)\n    .limit(20);\n  return (data || []).filter(p => p.id !== user?.id);\n}\n\n// ─── Follows ───\n\nexport async function followUser(followingId) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  const { error } = await supabase.from('follows')\n    .insert({ follower_id: user.id, following_id: followingId });\n  if (error) throw error;\n\n  // Log activity\n  const target = await getProfile(followingId);\n  await logActivity({\n    action: 'followed',\n    title: target?.username || 'someone',\n  });\n}\n\nexport async function unfollowUser(followingId) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  const { error } = await supabase.from('follows')\n    .delete()\n    .eq('follower_id', user.id)\n    .eq('following_id', followingId);\n  if (error) throw error;\n}\n\nexport async function getFollowing(userId) {\n  const { data } = await supabase.from('follows')\n    .select('following_id, profiles!follows_following_id_fkey(*)')\n    .eq('follower_id', userId);\n  return (data || []).map(d => d.profiles).filter(Boolean);\n}\n\nexport async function getFollowers(userId) {\n  const { data } = await supabase.from('follows')\n    .select('follower_id, profiles!follows_follower_id_fkey(*)')\n    .eq('following_id', userId);\n  return (data || []).map(d => d.profiles).filter(Boolean);\n}\n\nexport async function isFollowing(followingId) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return false;\n  const { data } = await supabase.from('follows')\n    .select('id')\n    .eq('follower_id', user.id)\n    .eq('following_id', followingId)\n    .maybeSingle();\n  return !!data;\n}\n\n// ─── Activity Feed ───\n\nexport async function logActivity(entry) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return;\n  await supabase.from('activity').insert({ user_id: user.id, ...entry }).select();\n}\n\nexport async function getFriendActivity(limit = 50) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return [];\n  // Get who I follow\n  const { data: follows } = await supabase.from('follows')\n    .select('following_id')\n    .eq('follower_id', user.id);\n  const followingIds = (follows || []).map(f => f.following_id);\n  if (followingIds.length === 0) return [];\n  // Get their activity\n  const { data } = await supabase.from('activity')\n    .select('*, profiles!activity_user_id_fkey(username, avatar_url)')\n    .in('user_id', followingIds)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n  return data || [];\n}\n\nexport async function getMyActivity(limit = 20) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return [];\n  const { data } = await supabase.from('activity')\n    .select('*')\n    .eq('user_id', user.id)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n  return data || [];\n}\n\n// ─── Blends (Spotify-style: shared taste between two users) ───\n\nexport async function getBlend(friendId) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return null;\n\n  // Get both libraries\n  const [myLib, friendLib] = await Promise.all([\n    supabase.from('library').select('*').eq('user_id', user.id).then(r => r.data || []),\n    supabase.from('library').select('*').eq('user_id', friendId).then(r => r.data || []),\n  ]);\n\n  // Find shared items\n  const myIds = new Set(myLib.map(i => i.tmdb_id || i.openlibrary_key).filter(Boolean));\n  const shared = friendLib.filter(i => myIds.has(i.tmdb_id || i.openlibrary_key));\n\n  // Score overlap by genre\n  const myGenres = {};\n  myLib.forEach(i => (i.genres || '').split(',').forEach(g => {\n    const t = g.trim();\n    if (t) myGenres[t] = (myGenres[t] || 0) + 1;\n  }));\n  const friendGenres = {};\n  friendLib.forEach(i => (i.genres || '').split(',').forEach(g => {\n    const t = g.trim();\n    if (t) friendGenres[t] = (friendGenres[t] || 0) + 1;\n  }));\n\n  // Shared genres sorted by overlap\n  const sharedGenres = Object.keys(myGenres)\n    .filter(g => friendGenres[g])\n    .map(g => ({ genre: g, overlap: Math.min(myGenres[g], friendGenres[g]) }))\n    .sort((a, b) => b.overlap - a.overlap)\n    .slice(0, 5);\n\n  // Compatibility score (0-100)\n  const totalPossible = Math.max(myLib.length, friendLib.length, 1);\n  const compatibility = Math.min(100, Math.round((shared.length / totalPossible) * 100 + sharedGenres.length * 5));\n\n  // Generate recommendations based on shared genres\n  let blendRecs = [];\n  if (sharedGenres.length > 0) {\n    const topGenre = sharedGenres[0].genre;\n    // Try to find the TMDB genre ID\n    const genreMap = { 'Action': 28, 'Comedy': 35, 'Drama': 18, 'Horror': 27, 'Romance': 10749, 'Thriller': 53, 'Sci-Fi': 878, 'Animation': 16, 'Crime': 80, 'Documentary': 99, 'Adventure': 12, 'Fantasy': 14, 'Mystery': 9648, 'Science Fiction': 878 };\n    const genreId = genreMap[topGenre];\n    if (genreId) {\n      const recs = await getMoviesByGenre(genreId);\n      const bothIds = new Set([...myLib, ...friendLib].map(i => i.tmdb_id).filter(Boolean));\n      blendRecs = recs.filter(r => !bothIds.has(r.id)).slice(0, 10);\n    }\n  }\n\n  return {\n    shared,\n    sharedGenres,\n    compatibility,\n    blendRecs,\n    myCount: myLib.length,\n    friendCount: friendLib.length,\n  };\n}\n\n// ─── Discover Weekly (personalized recs refreshed weekly) ───\n\nexport async function getDiscoverWeekly() {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return [];\n\n  const library = await getLibrary();\n  if (library.length < 3) return [];\n\n  // Use top-rated + recently added as seeds\n  const seeds = [...library]\n    .sort((a, b) => (b.user_rating || b.external_rating || 0) - (a.user_rating || a.external_rating || 0))\n    .slice(0, 5)\n    .filter(i => i.tmdb_id);\n\n  if (seeds.length === 0) return [];\n\n  // Fetch recs from TMDB for each seed\n  const allRecs = await Promise.all(\n    seeds.map(async (seed) => {\n      try {\n        const mt = seed.media_type === 'tv' ? 'tv' : 'movie';\n        const data = await tmdb(`/${mt}/${seed.tmdb_id}/recommendations`);\n        return (data.results || []).map(r => ({ ...r, media_type: mt }));\n      } catch { return []; }\n    })\n  );\n\n  // Deduplicate & remove existing library items\n  const libIds = new Set(library.map(i => String(i.tmdb_id)));\n  const seen = new Set();\n  const unique = allRecs.flat().filter(r => {\n    const key = `${r.media_type}-${r.id}`;\n    if (seen.has(key) || libIds.has(String(r.id))) return false;\n    seen.add(key);\n    return true;\n  });\n\n  // Score and sort\n  unique.sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0));\n\n  return unique.slice(0, 20);\n}\n\n// ─── Friend's Library (public view) ───\n\nexport async function getFriendLibrary(userId) {\n  const { data } = await supabase.from('library')\n    .select('*')\n    .eq('user_id', userId)\n    .order('added_at', { ascending: false });\n  return data || [];\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z',\n      key: 'r04s7s',\n    },\n  ],\n];\n\n/**\n * @component @name Star\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTEuNTI1IDIuMjk1YS41My41MyAwIDAgMSAuOTUgMGwyLjMxIDQuNjc5YTIuMTIzIDIuMTIzIDAgMCAwIDEuNTk1IDEuMTZsNS4xNjYuNzU2YS41My41MyAwIDAgMSAuMjk0LjkwNGwtMy43MzYgMy42MzhhMi4xMjMgMi4xMjMgMCAwIDAtLjYxMSAxLjg3OGwuODgyIDUuMTRhLjUzLjUzIDAgMCAxLS43NzEuNTZsLTQuNjE4LTIuNDI4YTIuMTIyIDIuMTIyIDAgMCAwLTEuOTczIDBMNi4zOTYgMjEuMDFhLjUzLjUzIDAgMCAxLS43Ny0uNTZsLjg4MS01LjEzOWEyLjEyMiAyLjEyMiAwIDAgMC0uNjExLTEuODc5TDIuMTYgOS43OTVhLjUzLjUzIDAgMCAxIC4yOTQtLjkwNmw1LjE2NS0uNzU1YTIuMTIyIDIuMTIyIDAgMCAwIDEuNTk3LTEuMTZ6IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/star\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Star = createLucideIcon('star', __iconNode);\n\nexport default Star;\n"],"names":["OMDB_KEY","process","OL_BASE","cache","Map","cached","key","fetcher","entry","get","Date","now","ts","Promise","resolve","data","then","set","SCORE_STORE_KEY","OMDB_STORE_KEY","_scoreCache","getScoreStore","JSON","parse","localStorage","getItem","_unused","getSyllabusScore","mediaType","id","_getScoreStore","concat","setSyllabusScore","score","setItem","stringify","_unused2","_saveScoreStore","applyStoredScores","items","store","forEach","item","unified_rating","_omdbCache","getOmdbStore","purged","k","Object","keys","_unused3","_unused4","saveOmdbEntry","_unused5","getOmdbEntry","_getOmdbStore$key","undefined","async","tmdb","endpoint","params","arguments","length","fetch","json","tmdbCached","getTrendingMovies","d","results","searchMovies","query","encodeURIComponent","getMovieDetails","getTrendingTV","searchTV","getTVDetails","getTopRatedMovies","getNowPlayingMovies","getMoviesByGenre","genreId","getTopRatedTV","getTVByGenre","getAnime","getAnimationTV","getTop100Movies","pages","all","map","p","seen","Set","flatMap","filter","m","has","add","getTop100TV","s","parseOMDbResponse","Response","ratings","imdb_id","imdbID","Ratings","r","Source","imdb","Value","votes","imdbVotes","rt","metacritic","Director","director","Writer","writer","Awards","awards","BoxOffice","boxOffice","Rated","rated","Country","country","getOMDbRatings","imdbId","title","type","storedKey","stored","res","Error","omdbType","url","fallbackRes","fallbackData","_unused6","getOMDbByTitle","year","result","_unused7","computeUnifiedRating","omdbData","malData","isAnime","_omdbData$imdb","scores","v","parseFloat","isNaN","push","_omdbData$rt","parseInt","reduce","a","b","toFixed","enrichItemsWithRatings","i","join","enriched","_objectSpread","scoreStore","needsFetch","storeKey","batch","slice","_item$genre_ids","_item$genres","name","release_date","first_air_date","original_language","genre_ids","includes","genres","some","g","omdb","mal","getMALRating","_unused8","sort","_ref","_ref2","_a$unified_rating","_ref3","_ref4","_b$unified_rating","ra","vote_average","rating","_data$data","anime","scored_by","mal_id","_unused9","mapOLWork","w","_w$author_name","_w$authors","_w$authors$","_w$subject","coverId","cover_i","cover_id","author","author_name","authors","poster_path","first_publish_year","ratings_average","Math","round","ratings_count","want_to_read","want_to_read_count","already_read","already_read_count","currently_reading","currently_reading_count","edition_count","subject","media_type","getTrendingBooks","works","_unused0","getBooksBySubject","_w$authors2","_w$authors2$","_unused1","searchBooks","docs","_unused10","getBookDetails","workKey","startsWith","_work$covers","_work$description","_ratings$summary","_ratings$summary2","_shelves$counts","_shelves$counts2","_shelves$counts3","_editions$entries","work","shelves","editions","catch","authorKeys","_a$author","Boolean","aKey","_a$photos","_a$bio","personal_name","photo","photos","bio","value","covers","desc","description","first_publish_date","subjects","summary","average","count","counts","size","entries","_unused11","getTop100Books","q","_unused12","multiSearch","tmdbData","booksRes","getLibrary","filters","user","supabase","auth","getUser","from","select","eq","order","ascending","status","error","addToLibrary","dupeQuery","tmdb_id","openlibrary_key","existing","insert","user_id","single","updateLibraryItem","updates","update","updated_at","toISOString","maybeSingle","message","removeFromLibrary","delete","getLibraryItemByMediaId","_ref5","GENRE_MAP","action","comedy","drama","scifi","thriller","romance","horror","animation","documentary","crime","fantasy","family","getCuratedPicks","genre","page","genreParam","SCENARIO_KEYWORDS","keywords","searchByScenario","toLowerCase","trim","sorted","phrase","config","kwIds","kwParam","movies","tv","floor","random","replace","MOOD_GENRES","light","movie","dark","mind","feel","adventure","chill","discoverByMood","mood","_MOOD_GENRES$mood","genreStr","getSmartRecommendations","libraryItems","seeds","user_rating","external_rating","allRecs","_data$recommendations","recommendations","_source","_sourceRating","_unused13","libraryIds","String","unique","flat","scoreA","AVATAR_PRESETS","getProfile","userId","getMyProfile","_user$user_metadata","_user$email","username","user_metadata","email","split","created","upsert","onConflict","console","updateProfile","searchUsers","ilike","limit","followUser","followingId","follower_id","following_id","target","logActivity","unfollowUser","getFollowing","profiles","getFollowers","isFollowing","getFriendActivity","follows","followingIds","f","in","getMyActivity","getBlend","friendId","myLib","friendLib","myIds","shared","myGenres","t","friendGenres","sharedGenres","overlap","min","totalPossible","max","compatibility","blendRecs","recs","bothIds","myCount","friendCount","getDiscoverWeekly","library","mt","seed","_unused14","libIds","getFriendLibrary","Star","createLucideIcon"],"sourceRoot":""}