{"version":3,"file":"static/js/942.fd870ec1.chunk.js","mappings":"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","sources":["services/googleBooks.js","services/api.js","../node_modules/lucide-react/src/icons/star.ts"],"sourcesContent":["// Google Books API integration for Syllabus\n// https://developers.google.com/books/docs/v1/using\n\nconst GOOGLE_BOOKS_BASE = 'https://www.googleapis.com/books/v1';\n\n/** Force HTTPS and strip the page-curl edge effect from a Google Books URL. */\nfunction cleanGBUrl(url) {\n  if (!url) return null;\n  return url.replace('http://', 'https://').replace(/&edge=curl/g, '');\n}\n\n/** Return a higher-resolution variant by switching to zoom=0 (full cover size). */\nfunction highResGBUrl(url) {\n  if (!url) return null;\n  return cleanGBUrl(url).replace(/\\bzoom=\\d+\\b/, 'zoom=0');\n}\n\n/**\n * Search books by title, author, or ISBN using Google Books API.\n * Supports Google's field operators (intitle:, inauthor:, isbn:).\n * @param {string} query\n * @param {number} [maxResults=20]\n * @returns {Promise<Array>} Array of mapped book objects\n */\nexport async function searchGoogleBooks(query, maxResults = 20) {\n  try {\n    const res = await fetch(\n      `${GOOGLE_BOOKS_BASE}/volumes?q=${encodeURIComponent(query)}&maxResults=${maxResults}&printType=books`\n    );\n    if (!res.ok) throw new Error(res.status);\n    const data = await res.json();\n    return (data.items || []).map(mapGoogleBook);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get book details by Google Books volume ID.\n * @param {string} volumeId\n * @returns {Promise<Object|null>} Book details object\n */\nexport async function getGoogleBookDetails(volumeId) {\n  try {\n    const res = await fetch(`${GOOGLE_BOOKS_BASE}/volumes/${volumeId}`);\n    if (!res.ok) throw new Error(res.status);\n    const data = await res.json();\n    return mapGoogleBook(data);\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Map Google Books API item to Syllabus book object shape.\n */\nexport function mapGoogleBook(item) {\n  const v = item.volumeInfo || {};\n\n  // Build cover URL chain: high-res (zoom=0, no curl) → standard (no curl) → other sizes.\n  // zoom=0 returns the full-size cover; zoom=1 is the standard thumbnail.\n  const rawThumb = v.imageLinks?.thumbnail || v.imageLinks?.smallThumbnail;\n  const cover_urls = [];\n  if (rawThumb) {\n    const hires = highResGBUrl(rawThumb);\n    const standard = cleanGBUrl(rawThumb);\n    if (hires) cover_urls.push(hires);\n    if (standard && standard !== hires) cover_urls.push(standard);\n  }\n  [v.imageLinks?.extraLarge, v.imageLinks?.large, v.imageLinks?.medium]\n    .filter(Boolean)\n    .forEach(url => {\n      const cleaned = cleanGBUrl(url);\n      if (cleaned && !cover_urls.includes(cleaned)) cover_urls.push(cleaned);\n    });\n\n  return {\n    key: item.id,\n    title: v.title || '',\n    author: (v.authors || [])[0] || 'Unknown',\n    description: v.description || '',\n    poster_path: cover_urls[0] || null,\n    cover_urls,\n    authors: (v.authors || []).map(name => ({ name })),\n    first_publish_date: v.publishedDate || '',\n    subjects: v.categories || [],\n    rating: v.averageRating || null,\n    ratings_count: v.ratingsCount || 0,\n    want_to_read: 0,\n    currently_reading: 0,\n    already_read: 0,\n    edition_count: 1,\n    media_type: 'book',\n    google_id: item.id,\n    industry_identifiers: v.industryIdentifiers || [],\n    info_link: v.infoLink || '',\n    preview_link: v.previewLink || '',\n  };\n}\n","\nimport { supabase } from './supabase';\nimport { searchGoogleBooks, getGoogleBookDetails, mapGoogleBook } from './googleBooks';\n\n// Patterns that identify non-canonical editions: study guides, summaries, etc.\nconst JUNK_EDITION_PATTERNS = [\n  /study guide/i, /\\bsummary\\b/i, /\\bsummaries\\b/i, /analysis of/i,\n  /condensed/i, /abridged/i, /cliffs? notes/i, /sparknotes/i,\n  /bookrags/i, /bookcaps/i, /\\bworkbook\\b/i, /teacher'?s? guide/i,\n  /reading guide/i, /\\bquiz\\b/i, /\\bcollect(ed|ion)\\b/i,\n];\n\n/**\n * Try to enrich a book object with Google Books cover URLs.\n * Prepends Google Books URLs so they're tried first (more reliable than OL),\n * keeping Open Library URLs as fallbacks. Mutates the book object in-place.\n *\n * Strategy:\n *  1. ISBN lookup — most precise, gets the exact edition\n *  2. intitle:/inauthor: field-operator search — fetch 8 candidates,\n *     filter out study guides/summaries, pick the one with the most\n *     Google ratings (most popular = canonical English edition)\n */\nasync function enrichBookWithGoogleCover(book) {\n  // Skip if we already have Google Books URLs in the chain\n  if ((book.cover_urls || []).some(u => u.includes('books.google.com') || u.includes('googleapis.com'))) {\n    return book;\n  }\n\n  let gbResults = [];\n\n  // ── Pass 1: ISBN lookup (most precise) ──────────────────────────────────\n  const isbns = (book.industry_identifiers || []).map(id => id.identifier)\n    .concat(book.isbn_13 || [], book.isbn_10 || [], book.isbn || []);\n  for (const isbn of isbns.slice(0, 5)) {\n    gbResults = await searchGoogleBooks(`isbn:${isbn}`, 1);\n    if (gbResults.length > 0) break;\n  }\n\n  // ── Pass 2: title + author field-operator search ─────────────────────────\n  if (gbResults.length === 0 && book.title) {\n    // Use intitle:/inauthor: for much more precise results than free-text search\n    const titleQ = `intitle:${book.title}`;\n    const q = book.author && book.author !== 'Unknown'\n      ? `${titleQ} inauthor:${book.author}`\n      : titleQ;\n    const candidates = await searchGoogleBooks(q, 8);\n\n    // Filter out non-canonical editions (study guides, summaries, etc.)\n    const filtered = candidates.filter(c => {\n      const t = c.title || '';\n      if (JUNK_EDITION_PATTERNS.some(p => p.test(t))) return false;\n      // Rough title match: at least half the significant words must overlap\n      const origWords = book.title.toLowerCase().split(/\\s+/).filter(w => w.length > 3);\n      if (origWords.length > 0) {\n        const ct = t.toLowerCase();\n        const matched = origWords.filter(w => ct.includes(w)).length;\n        if (matched / origWords.length < 0.5) return false;\n      }\n      return true;\n    });\n\n    // Sort by ratings_count descending — most popular = most canonical edition\n    const pool = filtered.length > 0 ? filtered : candidates;\n    pool.sort((a, b) => (b.ratings_count || 0) - (a.ratings_count || 0));\n    gbResults = pool.slice(0, 1);\n  }\n\n  if (gbResults.length > 0) {\n    const gb = gbResults[0];\n    if (gb.cover_urls && gb.cover_urls.length > 0) {\n      // Prepend Google Books covers (reliable), keep OL URLs as additional fallbacks\n      book.cover_urls = [...gb.cover_urls, ...(book.cover_urls || [])];\n      book.poster_path = gb.poster_path || book.poster_path;\n    }\n  }\n  return book;\n}\n\nconst TMDB_BASE = 'https://api.themoviedb.org/3';\nconst TMDB_KEY = process.env.REACT_APP_TMDB_API_KEY;\nconst OL_BASE = 'https://openlibrary.org';\n\n// ─── OMDb API key rotation ───\n// Free tier = 1,000 calls/day per key. Multiple keys give 2,000+/day.\n// Keys rotate automatically when one hits the rate limit.\nconst OMDB_KEYS = [\n  process.env.REACT_APP_OMDB_API_KEY || '4a3b711b',\n  '91f420c8',\n].filter(Boolean);\nlet _omdbKeyIdx = 0;\nconst _exhaustedKeys = new Set();\n\nfunction getNextOmdbKey() {\n  for (let i = 0; i < OMDB_KEYS.length; i++) {\n    const idx = (_omdbKeyIdx + i) % OMDB_KEYS.length;\n    if (!_exhaustedKeys.has(idx)) return idx;\n  }\n  _exhaustedKeys.clear(); // all exhausted → reset (quota may have refreshed)\n  return 0;\n}\n\nasync function omdbFetch(params) {\n  for (let attempt = 0; attempt < OMDB_KEYS.length; attempt++) {\n    const idx = getNextOmdbKey();\n    const key = OMDB_KEYS[idx];\n    const res = await fetch(`https://www.omdbapi.com/?${params}&apikey=${key}`);\n    const data = await res.json();\n    if (data.Error === 'Request limit reached!') {\n      _exhaustedKeys.add(idx);\n      _omdbKeyIdx = (idx + 1) % OMDB_KEYS.length;\n      continue;\n    }\n    return data;\n  }\n  return { Response: 'False', Error: 'Request limit reached!' };\n}\n\n// ─── In-memory cache (configurable TTL) ───\nconst cache = new Map();\nconst CACHE_TTL = 5 * 60 * 1000;       // default 5 min\nconst BOOK_CACHE_TTL = 60 * 60 * 1000; // books 1h (OL data is stable)\n\nfunction cached(key, fetcher, ttl = CACHE_TTL) {\n  const entry = cache.get(key);\n  if (entry && Date.now() - entry.ts < ttl) return Promise.resolve(entry.data);\n  return fetcher().then(data => {\n    cache.set(key, { data, ts: Date.now() });\n    return data;\n  });\n}\n\n// ─── Persistent Syllabus Score store (localStorage) ───\n// Scores never expire — movie ratings are stable.\n// Key format: \"movie:123\" or \"tv:456\" → score (number)\nconst SCORE_STORE_KEY = 'syllabus_scores';\nconst OMDB_STORE_KEY = 'syllabus_omdb';\n\nlet _scoreCache = null;\nfunction getScoreStore() {\n  if (!_scoreCache) {\n    try { _scoreCache = JSON.parse(localStorage.getItem(SCORE_STORE_KEY) || '{}'); }\n    catch { _scoreCache = {}; }\n  }\n  return _scoreCache;\n}\n\nfunction _saveScoreStore() {\n  try { localStorage.setItem(SCORE_STORE_KEY, JSON.stringify(_scoreCache)); } catch { /* quota */ }\n}\n\nexport function getSyllabusScore(mediaType, id) {\n  return getScoreStore()[`${mediaType}:${id}`] ?? null;\n}\n\nexport function setSyllabusScore(mediaType, id, score) {\n  if (score == null || !id) return;\n  const store = getScoreStore();\n  store[`${mediaType}:${id}`] = score;\n  _saveScoreStore();\n}\n\n// Batch apply stored scores to an array of items\nexport function applyStoredScores(items, mediaType) {\n  const store = getScoreStore();\n  items.forEach(item => {\n    const key = `${mediaType}:${item.id}`;\n    if (store[key] != null) {\n      item.unified_rating = store[key];\n    }\n  });\n  return items;\n}\n\n// ─── Persistent OMDb cache (localStorage) ───\nlet _omdbCache = null;\nfunction getOmdbStore() {\n  if (!_omdbCache) {\n    try {\n      _omdbCache = JSON.parse(localStorage.getItem(OMDB_STORE_KEY) || '{}');\n      // Purge null entries (stale rate-limit failures) so they can be re-fetched\n      let purged = false;\n      for (const k of Object.keys(_omdbCache)) {\n        if (_omdbCache[k] === null) { delete _omdbCache[k]; purged = true; }\n      }\n      if (purged) {\n        try { localStorage.setItem(OMDB_STORE_KEY, JSON.stringify(_omdbCache)); } catch { /* quota */ }\n      }\n    }\n    catch { _omdbCache = {}; }\n  }\n  return _omdbCache;\n}\n\nfunction saveOmdbEntry(key, data) {\n  const store = getOmdbStore();\n  store[key] = data;\n  try { localStorage.setItem(OMDB_STORE_KEY, JSON.stringify(store)); } catch { /* quota */ }\n}\n\nfunction getOmdbEntry(key) {\n  return getOmdbStore()[key] ?? undefined;\n}\n\n// ─── Static Score Database (pre-built by enrichment agent) ───\n// Loads scores.json on startup → merges into localStorage score store.\n// This means every popular movie/TV show has instant scores with zero live OMDb calls.\nconst STATIC_DB_KEY = 'syllabus_static_db_ts';\nconst STATIC_DB_TTL = 12 * 60 * 60 * 1000; // refresh static DB every 12h\n\nlet _staticDbLoaded = false;\n\nasync function loadStaticScoreDB() {\n  if (_staticDbLoaded) return;\n  _staticDbLoaded = true;\n\n  // Check if we loaded recently (avoid re-parsing on every page nav)\n  try {\n    const lastLoad = parseInt(localStorage.getItem(STATIC_DB_KEY) || '0');\n    if (Date.now() - lastLoad < STATIC_DB_TTL) return;\n  } catch { /* continue */ }\n\n  try {\n    const res = await fetch(`${process.env.PUBLIC_URL || ''}/data/scores.json`);\n    if (!res.ok) return;\n    const db = await res.json();\n\n    const scoreStore = getScoreStore();\n    let merged = 0;\n\n    for (const type of ['movie', 'tv']) {\n      const bucket = db[type];\n      if (!bucket) continue;\n      for (const [id, entry] of Object.entries(bucket)) {\n        const key = `${type}:${id}`;\n        // Only fill in scores that aren't already cached (user's live fetches take priority)\n        if (scoreStore[key] == null && entry.s != null) {\n          scoreStore[key] = entry.s;\n          merged++;\n        }\n      }\n    }\n\n    if (merged > 0) {\n      _saveScoreStore();\n      console.log(`[Syllabus] Loaded ${merged} pre-built scores from static database`);\n    }\n\n    localStorage.setItem(STATIC_DB_KEY, String(Date.now()));\n  } catch (err) {\n    console.warn('[Syllabus] Could not load static score DB:', err.message);\n  }\n}\n\n// Fire on module load (non-blocking)\nloadStaticScoreDB();\n\n// ─── Persistent Chart Cache (localStorage, 24h TTL) ───\n// Stores pre-sorted Top 100 lists so they load instantly on repeat visits.\nconst CHART_STORE_KEY = 'syllabus_charts';\nconst CHART_TTL = 24 * 60 * 60 * 1000; // 24 hours\n\n// Chart cache version — increment to bust stale caches when the data source changes.\nconst CHART_VERSION = 2; // v2: switched from popular to vote_average.desc source\n\nlet _chartCache = null;\nfunction getChartStore() {\n  if (!_chartCache) {\n    try {\n      const raw = JSON.parse(localStorage.getItem(CHART_STORE_KEY) || '{}');\n      // Bust cache if version changed (data source switched)\n      if (raw._v !== CHART_VERSION) {\n        _chartCache = { _v: CHART_VERSION };\n        try { localStorage.setItem(CHART_STORE_KEY, JSON.stringify(_chartCache)); } catch { /* quota */ }\n      } else {\n        _chartCache = raw;\n      }\n    } catch { _chartCache = { _v: CHART_VERSION }; }\n  }\n  return _chartCache;\n}\n\nfunction saveChart(chartKey, items) {\n  const store = getChartStore();\n  store[chartKey] = { items, ts: Date.now() };\n  store._v = CHART_VERSION;\n  try { localStorage.setItem(CHART_STORE_KEY, JSON.stringify(store)); } catch { /* quota */ }\n}\n\nexport function getCachedChart(chartKey) {\n  const entry = getChartStore()[chartKey];\n  if (!entry) return null;\n  if (Date.now() - entry.ts > CHART_TTL) return null; // stale\n  return entry.items;\n}\n\nexport function getChartAge(chartKey) {\n  const entry = getChartStore()[chartKey];\n  if (!entry) return Infinity;\n  return Date.now() - entry.ts;\n}\n\n// ─── TMDB helper ───\nasync function tmdb(endpoint, params = '') {\n  const res = await fetch(`${TMDB_BASE}${endpoint}?api_key=${TMDB_KEY}${params}`);\n  return res.json();\n}\n\nfunction tmdbCached(endpoint, params = '') {\n  return cached(`tmdb:${endpoint}${params}`, () => tmdb(endpoint, params));\n}\n\n// ─── Movies ───\n\nexport function getTrendingMovies() {\n  return tmdbCached('/trending/movie/week').then(d => d.results || []);\n}\n\nexport function getUpcomingMovies() {\n  return tmdbCached('/movie/upcoming').then(d => d.results || []);\n}\n\nexport async function searchMovies(query) {\n  const data = await tmdb('/search/movie', `&query=${encodeURIComponent(query)}`);\n  return data.results || [];\n}\n\nexport function getMovieDetails(id) {\n  return tmdbCached(`/movie/${id}`, '&append_to_response=recommendations,credits,watch/providers,external_ids,videos');\n}\n\n// ─── TV Shows ───\n\nexport function getTrendingTV() {\n  return tmdbCached('/trending/tv/week').then(d => d.results || []);\n}\n\nexport function getAiringTV() {\n  return tmdbCached('/tv/airing_today').then(d => d.results || []);\n}\n\nexport async function searchTV(query) {\n  const data = await tmdb('/search/tv', `&query=${encodeURIComponent(query)}`);\n  return data.results || [];\n}\n\nexport function getTVDetails(id) {\n  return tmdbCached(`/tv/${id}`, '&append_to_response=recommendations,credits,watch/providers,external_ids,videos');\n}\n\n// ─── Movie Discovery ───\n\nexport function getTopRatedMovies() {\n  return tmdbCached('/movie/top_rated').then(d => d.results || []);\n}\n\nexport function getNowPlayingMovies() {\n  return tmdbCached('/movie/now_playing').then(d => d.results || []);\n}\n\nexport function getPopularMovies() {\n  return tmdbCached('/movie/popular').then(d => d.results || []);\n}\n\nexport function getMoviesByGenre(genreId) {\n  return tmdbCached('/discover/movie', `&with_genres=${genreId}&sort_by=popularity.desc&vote_count.gte=50`).then(d => d.results || []);\n}\n\n// ─── TV Discovery ───\n\nexport function getTopRatedTV() {\n  return tmdbCached('/tv/top_rated').then(d => d.results || []);\n}\n\nexport function getPopularTV() {\n  return tmdbCached('/tv/popular').then(d => d.results || []);\n}\n\nexport function getTVByGenre(genreId) {\n  return tmdbCached('/discover/tv', `&with_genres=${genreId}&sort_by=popularity.desc&vote_count.gte=50`).then(d => d.results || []);\n}\n\nexport function getAnime() {\n  return tmdbCached('/discover/tv', '&with_genres=16&with_original_language=ja&sort_by=popularity.desc&vote_count.gte=50').then(d => d.results || []);\n}\n\nexport function getAnimationTV() {\n  return tmdbCached('/discover/tv', '&with_genres=16&without_original_language=ja&sort_by=popularity.desc&vote_count.gte=20').then(d => d.results || []);\n}\n\n// ─── Top 100 (TMDB — 5 pages × 20 = 100) ───\n\nexport function getTop100Movies(genreId = null) {\n  const key = genreId ? `top100:movies:${genreId}` : 'top100:movies';\n  return cached(key, async () => {\n    // Use discover sorted by vote_average (descending) with high minimum votes\n    // to ensure only genuinely well-rated films appear in the Top 100.\n    const genreParam = genreId ? `&with_genres=${genreId}` : '';\n    const minVotes = genreId ? 500 : 1000; // lower threshold for genres (smaller pools)\n    const pages = await Promise.all(\n      [1, 2, 3, 4, 5].map(p =>\n        tmdb('/discover/movie', `&sort_by=vote_average.desc&vote_count.gte=${minVotes}${genreParam}&page=${p}`)\n      )\n    );\n    const seen = new Set();\n    return pages.flatMap(p => p.results || []).filter(m => {\n      if (seen.has(m.id)) return false; seen.add(m.id); return true;\n    });\n  });\n}\n\nexport function getTop100TV(genreId = null) {\n  const key = genreId ? `top100:tv:${genreId}` : 'top100:tv';\n  return cached(key, async () => {\n    const genreParam = genreId ? `&with_genres=${genreId}` : '';\n    const minVotes = genreId ? 200 : 500;\n    const pages = await Promise.all(\n      [1, 2, 3, 4, 5].map(p =>\n        tmdb('/discover/tv', `&sort_by=vote_average.desc&vote_count.gte=${minVotes}${genreParam}&page=${p}`)\n      )\n    );\n    const seen = new Set();\n    return pages.flatMap(p => p.results || []).filter(s => {\n      if (seen.has(s.id)) return false; seen.add(s.id); return true;\n    });\n  });\n}\n\n// ─── OMDb (IMDb + Rotten Tomatoes + Metacritic) ───\n\nfunction parseOMDbResponse(data) {\n  if (!data || data.Response === 'False') return null;\n  const ratings = { imdb_id: data.imdbID };\n  (data.Ratings || []).forEach(r => {\n    if (r.Source === 'Internet Movie Database') {\n      ratings.imdb = { score: r.Value, votes: data.imdbVotes };\n    } else if (r.Source === 'Rotten Tomatoes') {\n      ratings.rt = { score: r.Value };\n    } else if (r.Source === 'Metacritic') {\n      ratings.metacritic = { score: r.Value };\n    }\n  });\n  if (data.Director && data.Director !== 'N/A') ratings.director = data.Director;\n  if (data.Writer && data.Writer !== 'N/A') ratings.writer = data.Writer;\n  if (data.Awards && data.Awards !== 'N/A') ratings.awards = data.Awards;\n  if (data.BoxOffice && data.BoxOffice !== 'N/A') ratings.boxOffice = data.BoxOffice;\n  if (data.Rated && data.Rated !== 'N/A') ratings.rated = data.Rated;\n  if (data.Country && data.Country !== 'N/A') ratings.country = data.Country;\n  return ratings;\n}\n\nexport function getOMDbRatings(imdbId, title = null, type = null) {\n  if (!imdbId) return Promise.resolve(null);\n  // Check persistent localStorage cache first\n  const storedKey = `i:${imdbId}`;\n  const stored = getOmdbEntry(storedKey);\n  if (stored !== undefined) return Promise.resolve(stored);\n\n  return cached(`omdb:${imdbId}`, async () => {\n    try {\n      const data = await omdbFetch(`i=${imdbId}`);\n      // Throw on rate-limit so cached() doesn't store the failure\n      if (data.Error === 'Request limit reached!') throw new Error('OMDB_RATE_LIMIT');\n      const ratings = parseOMDbResponse(data);\n      if (!ratings) { saveOmdbEntry(storedKey, null); return null; }\n\n      // If no RT score and we have a title, try searching by title as fallback\n      if (!ratings.rt && title) {\n        const omdbType = type === 'tv' ? 'series' : type === 'movie' ? 'movie' : '';\n        let params = `t=${encodeURIComponent(title)}`;\n        if (omdbType) params += `&type=${omdbType}`;\n        const fallbackData = await omdbFetch(params);\n        if (fallbackData.Response !== 'False') {\n          (fallbackData.Ratings || []).forEach(r => {\n            if (r.Source === 'Rotten Tomatoes' && !ratings.rt) {\n              ratings.rt = { score: r.Value };\n            }\n          });\n        }\n      }\n\n      saveOmdbEntry(storedKey, ratings);\n      return ratings;\n    } catch (err) {\n      if (err?.message === 'OMDB_RATE_LIMIT') throw err; // don't cache, allow retry\n      return null;\n    }\n  });\n}\n\n// ─── OMDb by title (used for Top 100 enrichment where we lack IMDb IDs) ───\n\nexport function getOMDbByTitle(title, year, type = 'movie') {\n  if (!title) return Promise.resolve(null);\n  const omdbType = type === 'tv' ? 'series' : 'movie';\n  const storedKey = `t:${title}:${year || ''}:${omdbType}`;\n  const stored = getOmdbEntry(storedKey);\n  if (stored !== undefined) return Promise.resolve(stored);\n\n  return cached(`omdb:t:${title}:${year || ''}:${omdbType}`, async () => {\n    try {\n      let params = `t=${encodeURIComponent(title)}&type=${omdbType}`;\n      if (year) params += `&y=${year}`;\n      const data = await omdbFetch(params);\n      if (data.Error === 'Request limit reached!') throw new Error('OMDB_RATE_LIMIT');\n      const result = parseOMDbResponse(data);\n      saveOmdbEntry(storedKey, result);\n      return result;\n    } catch (err) {\n      if (err?.message === 'OMDB_RATE_LIMIT') throw err; // propagate so enrichment stops\n      return null;\n    }\n  });\n}\n\n// ─── Unified Rating: avg(IMDb, RT/10) or avg(IMDb, MAL) for anime ───\n// Returns a single /10 score or null if no data at all\n\nexport function computeUnifiedRating(omdbData, malData, isAnime) {\n  const scores = [];\n  if (omdbData?.imdb?.score) {\n    const v = parseFloat(omdbData.imdb.score);\n    if (!isNaN(v)) scores.push(v);\n  }\n  if (isAnime) {\n    if (malData?.score) scores.push(malData.score);\n  } else {\n    if (omdbData?.rt?.score) {\n      const v = parseInt(omdbData.rt.score);\n      if (!isNaN(v)) scores.push(v / 10);\n    }\n  }\n  if (scores.length === 0) return null;\n  return parseFloat((scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1));\n}\n\n// ─── Chart Enrichment Agent ───\n// Enriches items with Syllabus Scores in throttled background batches.\n// Persists results to localStorage chart cache + score store.\n// Provides progress callbacks so the UI can show a progress bar.\n\nexport async function enrichChart(items, mediaType, chartKey, onProgress) {\n  const enriched = items.map(i => ({ ...i }));\n  const scoreStore = getScoreStore();\n\n  // First pass: apply stored scores instantly (zero API calls)\n  const needsFetch = [];\n  enriched.forEach(item => {\n    const key = `${mediaType}:${item.id}`;\n    if (scoreStore[key] != null) {\n      item.unified_rating = scoreStore[key];\n    } else {\n      needsFetch.push(item);\n    }\n  });\n\n  const total = needsFetch.length;\n  let completed = 0;\n\n  if (total > 0 && onProgress) onProgress({ completed: 0, total, phase: 'enriching' });\n\n  // Second pass: batch OMDb lookups with throttling\n  // Conservative batching to preserve OMDb quota for Details pages\n  const BATCH_SIZE = 3;\n  const BATCH_DELAY = 500; // ms between batches to avoid rate-limits\n  let rateLimited = false;\n\n  for (let i = 0; i < needsFetch.length && !rateLimited; i += BATCH_SIZE) {\n    const batch = needsFetch.slice(i, i + BATCH_SIZE);\n    await Promise.all(batch.map(async (item) => {\n      if (rateLimited) return; // skip if we hit the limit mid-batch\n      const title = item.title || item.name;\n      const year = (item.release_date || item.first_air_date || '').slice(0, 4);\n      const isAnime = item.original_language === 'ja' &&\n        (item.genre_ids?.includes(16) || item.genres?.some(g => g.id === 16));\n\n      try {\n        const omdb = await getOMDbByTitle(title, year, mediaType);\n        let mal = null;\n        if (isAnime) {\n          try { mal = await getMALRating(title); } catch { /* ignore */ }\n        }\n        item.unified_rating = computeUnifiedRating(omdb, mal, isAnime);\n        if (item.unified_rating != null) {\n          setSyllabusScore(mediaType, item.id, item.unified_rating);\n        }\n      } catch (err) {\n        if (err?.message === 'OMDB_RATE_LIMIT') {\n          rateLimited = true; // stop enriching, preserve quota for Details\n        }\n      }\n    }));\n\n    completed += batch.length;\n    if (onProgress) onProgress({ completed, total, phase: 'enriching' });\n\n    // Throttle between batches (skip delay on last batch)\n    if (i + BATCH_SIZE < needsFetch.length) {\n      await new Promise(r => setTimeout(r, BATCH_DELAY));\n    }\n  }\n\n  // Sort by Syllabus Score (fallback to vote_average)\n  enriched.sort((a, b) => {\n    const ra = a.unified_rating ?? a.vote_average ?? a.rating ?? 0;\n    const rb = b.unified_rating ?? b.vote_average ?? b.rating ?? 0;\n    return rb - ra;\n  });\n\n  // Persist the sorted chart for instant loading next time\n  if (chartKey) {\n    const slim = enriched.map(({ id, title, name, poster_path, release_date, first_air_date,\n      vote_average, unified_rating, genre_ids, genres, original_language, overview }) => ({\n      id, title, name, poster_path, release_date, first_air_date,\n      vote_average, unified_rating, genre_ids, genres, original_language,\n      overview: overview?.slice(0, 200),\n    }));\n    saveChart(chartKey, slim);\n  }\n\n  if (onProgress) onProgress({ completed: total, total, phase: 'done' });\n  return enriched;\n}\n\n// Legacy wrapper for non-chart enrichment (e.g. Home page rows)\nexport function enrichItemsWithRatings(items, mediaType) {\n  return enrichChart(items, mediaType, null, null);\n}\n\n// ─── MAL / Jikan (Anime ratings) ───\n\nexport function getMALRating(title) {\n  if (!title) return Promise.resolve(null);\n  return cached(`mal:${title}`, async () => {\n    try {\n      const res = await fetch(`https://api.jikan.moe/v4/anime?q=${encodeURIComponent(title)}&limit=1`);\n      const data = await res.json();\n      const anime = data.data?.[0];\n      if (!anime) return null;\n      return {\n        score: anime.score,\n        scored_by: anime.scored_by,\n        mal_id: anime.mal_id,\n        url: anime.url,\n      };\n    } catch { return null; }\n  });\n}\n\n// ─── Books (Open Library) ──────────────────────────────────────\n\nconst OL_COVERS = 'https://covers.openlibrary.org';\nconst OL_SEARCH_FIELDS = [\n  'key', 'title', 'author_name', 'cover_i', 'cover_edition_key',\n  'isbn', 'first_publish_year', 'ratings_average', 'ratings_count',\n  'edition_count', 'subject',\n].join(',');\n\n/**\n * Build an ordered array of candidate cover URLs for a book.\n * The UI component (BookCover) tries each in sequence until one loads.\n * @param {Object} work — search result or trending item\n * @param {'M'|'L'} size — M for cards/lists, L for detail pages\n */\nfunction buildCoverUrls(work, size = 'M') {\n  const urls = [];\n\n  // 1. Cover ID — most reliable when present\n  const coverId = work.cover_i || work.cover_id;\n  if (coverId && Number(coverId) > 0) {\n    urls.push(`${OL_COVERS}/b/id/${coverId}-${size}.jpg`);\n  }\n\n  // 2. ISBNs — try up to 3 unique ISBNs (different editions have different covers)\n  const seen = new Set();\n  for (const isbn of [...(work.isbn || []), ...(work.isbn_13 || []), ...(work.isbn_10 || [])]) {\n    if (!seen.has(isbn)) {\n      seen.add(isbn);\n      urls.push(`${OL_COVERS}/b/isbn/${isbn}-${size}.jpg`);\n    }\n    if (seen.size >= 3) break;\n  }\n\n  // 3. Edition OLID\n  if (work.cover_edition_key) {\n    urls.push(`${OL_COVERS}/b/olid/${work.cover_edition_key}-${size}.jpg`);\n  }\n\n  return urls;\n}\n\n/** Map an Open Library search/trending result to our standard book shape. */\nfunction mapOLBook(w) {\n  const coverUrls = buildCoverUrls(w, 'M');\n  return {\n    key: w.key,\n    title: w.title,\n    author: w.author_name?.[0] || w.authors?.[0]?.name || 'Unknown',\n    poster_path: coverUrls[0] || null,\n    cover_urls: coverUrls,\n    isbn: w.isbn || [],  // kept so enrichBookWithGoogleCover can do ISBN lookup\n    first_publish_year: w.first_publish_year,\n    rating: w.ratings_average ? Math.round(w.ratings_average * 20) / 10 : null,\n    ratings_count: w.ratings_count || 0,\n    want_to_read: w.want_to_read_count || 0,\n    already_read: w.already_read_count || 0,\n    currently_reading: w.currently_reading_count || 0,\n    edition_count: w.edition_count || 0,\n    subject: (w.subject || []).slice(0, 5),\n    media_type: 'book',\n  };\n}\n\n/** Map a subjects-API work (different response shape: cover_id, authors array). */\nfunction mapSubjectWork(w) {\n  const coverUrls = [];\n  if (w.cover_id && Number(w.cover_id) > 0) {\n    coverUrls.push(`${OL_COVERS}/b/id/${w.cover_id}-M.jpg`);\n  }\n  if (w.cover_edition_key) {\n    coverUrls.push(`${OL_COVERS}/b/olid/${w.cover_edition_key}-M.jpg`);\n  }\n  return {\n    key: w.key,\n    title: w.title,\n    author: w.authors?.[0]?.name || 'Unknown',\n    poster_path: coverUrls[0] || null,\n    cover_urls: coverUrls,\n    first_publish_year: w.first_publish_year,\n    edition_count: w.edition_count || 0,\n    media_type: 'book',\n  };\n}\n\n/** Enrich a list of books in small batches to avoid Google Books rate limits. */\nasync function enrichBatch(books, batchSize = 4) {\n  for (let i = 0; i < books.length; i += batchSize) {\n    await Promise.all(books.slice(i, i + batchSize).map(b => enrichBookWithGoogleCover(b)));\n  }\n}\n\n/** Trending books this week (weekly is more stable than daily). */\nexport function getTrendingBooks() {\n  return cached('ol:trending', async () => {\n    try {\n      const res = await fetch(`${OL_BASE}/trending/weekly.json?limit=30`);\n      if (!res.ok) throw new Error(res.status);\n      const data = await res.json();\n      let books = (data.works || []).map(mapOLBook).slice(0, 20);\n      await enrichBatch(books);\n      return books.filter(b => b.cover_urls.length > 0);\n    } catch { return []; }\n  }, BOOK_CACHE_TTL);\n}\n\n/** Browse books by subject — uses the subjects API (faster than search). */\nexport function getBooksBySubject(subject) {\n  const slug = subject.toLowerCase().replace(/\\s+/g, '_');\n  return cached(`ol:subject:${slug}`, async () => {\n    try {\n      const res = await fetch(\n        `${OL_BASE}/subjects/${encodeURIComponent(slug)}.json?limit=24&details=false`\n      );\n      if (!res.ok) throw new Error(res.status);\n      const data = await res.json();\n      let books = (data.works || []).map(mapSubjectWork);\n      await enrichBatch(books);\n      return books.filter(b => b.cover_urls.length > 0);\n    } catch { return []; }\n  }, BOOK_CACHE_TTL);\n}\n\n\n/** Search books by title/author/ISBN. Tries Google Books first, falls back to Open Library. */\nexport async function searchBooks(query) {\n  let results = await searchGoogleBooks(query, 24);\n  if (results.length > 0) return results;\n  // fallback to Open Library\n  try {\n    const res = await fetch(\n      `${OL_BASE}/search.json?q=${encodeURIComponent(query)}&limit=24&fields=${OL_SEARCH_FIELDS}`\n    );\n    if (!res.ok) throw new Error(res.status);\n    const data = await res.json();\n    const books = (data.docs || []).map(mapOLBook);\n    await enrichBatch(books);\n    return books;\n  } catch { return []; }\n}\n\n\n// ─── Book Detail (Google Books first, fallback to Open Library) ───\nexport function getBookDetails(workKey) {\n  // If it's a Google Books ID (no /works/), try Google Books first\n  if (!workKey.startsWith('/works/')) {\n    return cached(`gb:detail:${workKey}`, async () => {\n      const gb = await getGoogleBookDetails(workKey);\n      if (gb) return gb;\n      // fallback to Open Library if not found\n      return getBookDetails(`/works/${workKey}`);\n    }, BOOK_CACHE_TTL);\n  }\n  // Otherwise, Open Library as before\n  const key = workKey.startsWith('/works/') ? workKey : `/works/${workKey}`;\n  return cached(`ol:detail:${key}`, async () => {\n    try {\n      const [work, ratings, shelves, editions] = await Promise.all([\n        fetch(`${OL_BASE}${key}.json`).then(r => r.json()),\n        fetch(`${OL_BASE}${key}/ratings.json`).then(r => r.json()).catch(() => null),\n        fetch(`${OL_BASE}${key}/bookshelves.json`).then(r => r.json()).catch(() => null),\n        fetch(`${OL_BASE}${key}/editions.json?limit=10`).then(r => r.json()).catch(() => null),\n      ]);\n      // ...existing code for Open Library mapping...\n      // Resolve authors (up to 5, parallel)\n      const authorKeys = (work.authors || [])\n        .map(a => a.author?.key || a.key)\n        .filter(Boolean)\n        .slice(0, 5);\n      const authorResults = await Promise.all(\n        authorKeys.map(k =>\n          fetch(`${OL_BASE}${k}.json`).then(r => r.json()).catch(() => null)\n        )\n      );\n      const authors = authorResults.filter(Boolean).map(a => ({\n        name: a.name || a.personal_name || 'Unknown',\n        key: a.key,\n        photo: a.photos?.[0] ? `${OL_COVERS}/a/id/${a.photos[0]}-M.jpg` : null,\n        bio: typeof a.bio === 'string' ? a.bio : a.bio?.value || '',\n      }));\n      // Build cover URL chain (L size for detail view)\n      const coverUrls = [];\n      for (const coverId of (work.covers || []).slice(0, 3)) {\n        if (coverId > 0) coverUrls.push(`${OL_COVERS}/b/id/${coverId}-L.jpg`);\n      }\n      for (const ed of (editions?.entries || []).slice(0, 10)) {\n        for (const coverId of (ed.covers || []).slice(0, 2)) {\n          if (coverId > 0) coverUrls.push(`${OL_COVERS}/b/id/${coverId}-L.jpg`);\n        }\n        const isbn = ed.isbn_13?.[0] || ed.isbn_10?.[0];\n        if (isbn) coverUrls.push(`${OL_COVERS}/b/isbn/${isbn}-L.jpg`);\n        const olid = ed.key?.replace('/books/', '');\n        if (olid) coverUrls.push(`${OL_COVERS}/b/olid/${olid}-L.jpg`);\n      }\n      const uniqueCovers = [...new Set(coverUrls)];\n      const desc = typeof work.description === 'string'\n        ? work.description\n        : work.description?.value || '';\n      const result = {\n        key: work.key,\n        title: work.title,\n        author: authors[0]?.name || 'Unknown',\n        description: desc,\n        poster_path: uniqueCovers[0] || null,\n        cover_urls: uniqueCovers,\n        first_publish_date: work.first_publish_date || '',\n        subjects: (work.subjects || []).slice(0, 8),\n        rating: ratings?.summary?.average\n          ? Math.round(ratings.summary.average * 20) / 10\n          : null,\n        ratings_count: ratings?.summary?.count || 0,\n        want_to_read: shelves?.counts?.want_to_read || 0,\n        currently_reading: shelves?.counts?.currently_reading || 0,\n        already_read: shelves?.counts?.already_read || 0,\n        edition_count: editions?.size || editions?.entries?.length || 0,\n        authors,\n        media_type: 'book',\n      };\n      // Enrich with Google Books cover to avoid wrong-edition OL covers\n      await enrichBookWithGoogleCover(result);\n      return result;\n    } catch { return null; }\n  }, BOOK_CACHE_TTL);\n}\n\n// ─── Top 100 Books (by rating, minimum 20 votes for quality) ───\n\nexport function getTop100Books(subject = null) {\n  const key = subject ? `top100:books:${subject}` : 'top100:books';\n  return cached(key, async () => {\n    try {\n      const q = subject\n        ? `subject:${subject}`\n        : 'subject:fiction OR subject:literature';\n      const res = await fetch(\n        `${OL_BASE}/search.json?q=${encodeURIComponent(q)}&sort=rating+desc&limit=150` +\n        `&fields=${OL_SEARCH_FIELDS},want_to_read_count,already_read_count,currently_reading_count`\n      );\n      if (!res.ok) throw new Error(res.status);\n      const data = await res.json();\n      let books = (data.docs || [])\n        .filter(d => (d.ratings_count || 0) >= 20 && d.ratings_average)\n        .sort((a, b) => (b.ratings_average || 0) - (a.ratings_average || 0))\n        .slice(0, 120)\n        .map(mapOLBook);\n      await enrichBatch(books);\n      return books.filter(b => b.cover_urls.length > 0).slice(0, 100);\n    } catch { return []; }\n  }, BOOK_CACHE_TTL);\n}\n\nexport async function getBookRecommendations(book) {\n  const subjects = book.subjects || book.subject || [];\n  if (subjects.length === 0) return [];\n  for (const subject of subjects.slice(0, 3)) {\n    try {\n      const slug = subject.toLowerCase().replace(/[\\s/]+/g, '_').replace(/[^a-z0-9_]/g, '');\n      if (!slug) continue;\n      const results = await getBooksBySubject(slug);\n      const filtered = results.filter(b => b.key !== book.key);\n      if (filtered.length >= 4) return filtered.slice(0, 8);\n    } catch { continue; }\n  }\n  return [];\n}\n\n// ─── Multi-search ───\n\nexport async function multiSearch(query) {\n  const [tmdbData, booksRes] = await Promise.all([\n    tmdb('/search/multi', `&query=${encodeURIComponent(query)}`),\n    fetch(`${OL_BASE}/search.json?q=${encodeURIComponent(query)}&limit=5&fields=key,title,author_name,cover_i,cover_edition_key,isbn,first_publish_year`)\n      .then(r => r.json()).catch(() => ({ docs: [] })),\n  ]);\n\n  const media = (tmdbData.results || []).filter(r => r.media_type === 'movie' || r.media_type === 'tv');\n  const books = (booksRes.docs || []).slice(0, 5).map(mapOLBook);\n\n  return [...media, ...books];\n}\n\n// ─── Library (Supabase) ───\n\nexport async function getLibrary(filters = {}) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  let query = supabase.from('library').select('*').eq('user_id', user.id).order('added_at', { ascending: false });\n  if (filters.media_type) query = query.eq('media_type', filters.media_type);\n  if (filters.status) query = query.eq('status', filters.status);\n  const { data, error } = await query;\n  if (error) throw error;\n  return data || [];\n}\n\nexport async function addToLibrary(item) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n\n  // ─ Duplicate check ─\n  let dupeQuery = supabase.from('library').select('id').eq('user_id', user.id);\n  if (item.tmdb_id) dupeQuery = dupeQuery.eq('tmdb_id', item.tmdb_id);\n  else if (item.openlibrary_key) dupeQuery = dupeQuery.eq('openlibrary_key', item.openlibrary_key);\n  const { data: existing } = await dupeQuery;\n  if (existing && existing.length > 0) throw new Error('Already in your library');\n\n  const { data, error } = await supabase.from('library').insert({\n    user_id: user.id,\n    status: 'watching',\n    ...item,\n  }).select().single();\n  if (error) throw error;\n  return data;\n}\n\nexport async function updateLibraryItem(id, updates) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  // Use maybeSingle so a 0-row result doesn't throw PGRST116\n  const { data, error } = await supabase.from('library')\n    .update({ ...updates, updated_at: new Date().toISOString() })\n    .eq('id', id)\n    .eq('user_id', user.id)\n    .select()\n    .maybeSingle();\n  if (error) throw new Error(error.message || 'Update failed');\n  if (!data) throw new Error('Item not found — it may have been removed');\n  return data;\n}\n\nexport async function removeFromLibrary(id) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  const { error } = await supabase.from('library').delete().eq('id', id).eq('user_id', user.id);\n  if (error) throw error;\n}\n\n// Look up a library item by tmdb_id or openlibrary_key for the current user\nexport async function getLibraryItemByMediaId({ tmdb_id, openlibrary_key }) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return null;\n  let query = supabase.from('library').select('*').eq('user_id', user.id);\n  if (tmdb_id) query = query.eq('tmdb_id', tmdb_id);\n  else if (openlibrary_key) query = query.eq('openlibrary_key', openlibrary_key);\n  else return null;\n  const { data } = await query.maybeSingle();\n  return data || null;\n}\n\n// ─── Curated Picks (high quality, well-rated) ───\n\nconst GENRE_MAP = {\n  all: '',\n  action: '28', comedy: '35', drama: '18', scifi: '878',\n  thriller: '53', romance: '10749', horror: '27', animation: '16',\n  documentary: '99', crime: '80', fantasy: '14', family: '10751',\n};\n\nexport async function getCuratedPicks(genre = 'all', page = 1) {\n  const genreParam = GENRE_MAP[genre] ? `&with_genres=${GENRE_MAP[genre]}` : '';\n  const data = await tmdb('/discover/movie', `&sort_by=vote_average.desc&vote_count.gte=500&vote_average.gte=6${genreParam}&page=${page}`);\n  return data.results || [];\n}\n\n// ─── AI Scenario Search ───\n\nconst SCENARIO_KEYWORDS = {\n  'date night': { genres: '10749,35', keywords: '' },\n  'date': { genres: '10749,35', keywords: '' },\n  'romantic': { genres: '10749', keywords: '' },\n  'family': { genres: '10751,16', keywords: '' },\n  'kids': { genres: '10751,16', keywords: '' },\n  'children': { genres: '10751,16', keywords: '' },\n  'scary': { genres: '27', keywords: '' },\n  'horror': { genres: '27', keywords: '' },\n  'funny': { genres: '35', keywords: '' },\n  'laugh': { genres: '35', keywords: '' },\n  'comedy': { genres: '35', keywords: '' },\n  'cry': { genres: '18,10749', keywords: '' },\n  'emotional': { genres: '18,10749', keywords: '' },\n  'sad': { genres: '18', keywords: '' },\n  'action': { genres: '28', keywords: '' },\n  'adrenaline': { genres: '28,53', keywords: '' },\n  'escape': { genres: '14,12,878', keywords: '' },\n  'mind off': { genres: '28,12,35', keywords: '' },\n  'take my mind': { genres: '28,12,35,14', keywords: '' },\n  'relax': { genres: '35,10751,10402', keywords: '' },\n  'chill': { genres: '35,10402', keywords: '' },\n  'thriller': { genres: '53,9648', keywords: '' },\n  'suspense': { genres: '53,9648', keywords: '' },\n  'mystery': { genres: '9648', keywords: '' },\n  'mind bending': { genres: '878,9648', keywords: '' },\n  'trippy': { genres: '878,9648', keywords: '' },\n  'sci-fi': { genres: '878', keywords: '' },\n  'space': { genres: '878', keywords: '1612' },\n  'war': { genres: '10752,18', keywords: '' },\n  'history': { genres: '36', keywords: '' },\n  'true story': { genres: '18,36', keywords: '9672' },\n  'based on': { genres: '18', keywords: '9672' },\n  'superhero': { genres: '28,878', keywords: '9715' },\n  'animated': { genres: '16', keywords: '' },\n  'anime': { genres: '16', keywords: '' },\n  'documentary': { genres: '99', keywords: '' },\n  'learn': { genres: '99,36', keywords: '' },\n  'inspiring': { genres: '18', keywords: '9748' },\n  'motivat': { genres: '18', keywords: '9748' },\n  'adventure': { genres: '12,28', keywords: '' },\n  'fantasy': { genres: '14', keywords: '' },\n  'magic': { genres: '14', keywords: '' },\n  'zombie': { genres: '27', keywords: '12377' },\n  'survival': { genres: '28,53', keywords: '10349' },\n  'heist': { genres: '80,53', keywords: '10051' },\n  'feel good': { genres: '35,10751,10749', keywords: '' },\n  'wholesome': { genres: '35,10751', keywords: '' },\n  'coming of age': { genres: '18', keywords: '10683' },\n  'teen': { genres: '18,35', keywords: '10683' },\n  'western': { genres: '37', keywords: '' },\n  'music': { genres: '10402', keywords: '' },\n  'sport': { genres: '18', keywords: '6075' },\n  'revenge': { genres: '28,53', keywords: '10084' },\n};\n\nexport async function searchByScenario(query) {\n  const q = query.toLowerCase().trim();\n  let genres = '';\n  let keywords = '';\n\n  // Match scenario keywords (longest first for multi-word matches)\n  const sorted = Object.entries(SCENARIO_KEYWORDS).sort((a, b) => b[0].length - a[0].length);\n  for (const [phrase, config] of sorted) {\n    if (q.includes(phrase)) {\n      genres = config.genres;\n      keywords = config.keywords;\n      break;\n    }\n  }\n\n  if (!genres) {\n    // Fallback: TMDB keyword search\n    const kwRes = await tmdb('/search/keyword', `&query=${encodeURIComponent(q)}`);\n    const kwIds = (kwRes.results || []).slice(0, 3).map(k => k.id).join('|');\n    if (kwIds) {\n      const data = await tmdb('/discover/movie', `&with_keywords=${kwIds}&sort_by=vote_average.desc&vote_count.gte=100`);\n      return (data.results || []).map(r => ({ ...r, media_type: 'movie' }));\n    }\n    // Last resort: regular search\n    const data = await tmdb('/search/movie', `&query=${encodeURIComponent(query)}`);\n    return (data.results || []).map(r => ({ ...r, media_type: 'movie' }));\n  }\n\n  const kwParam = keywords ? `&with_keywords=${keywords}` : '';\n  const [movies, tv] = await Promise.all([\n    tmdb('/discover/movie', `&with_genres=${genres}${kwParam}&sort_by=vote_average.desc&vote_count.gte=200&page=${Math.floor(Math.random() * 3) + 1}`),\n    tmdb('/discover/tv', `&with_genres=${genres.replace('10752','10768').replace('10751','10751')}${kwParam}&sort_by=vote_average.desc&vote_count.gte=200&page=${Math.floor(Math.random() * 2) + 1}`),\n  ]);\n\n  const combined = [\n    ...(movies.results || []).map(r => ({ ...r, media_type: 'movie' })),\n    ...(tv.results || []).map(r => ({ ...r, media_type: 'tv' })),\n  ].sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0));\n\n  return combined.slice(0, 20);\n}\n\n// ─── TMDB Discover by Mood ───\n\nconst MOOD_GENRES = {\n  light: { movie: '35,10751,10402', tv: '35,10751' }, // Comedy, Family, Music\n  dark: { movie: '28,53,27,80', tv: '28,80,9648' }, // Action, Thriller, Horror, Crime\n  mind: { movie: '878,9648,14', tv: '878,9648' }, // Sci-Fi, Mystery, Fantasy\n  feel: { movie: '10749,18,10402', tv: '10749,18' }, // Romance, Drama, Music\n  adventure: { movie: '12,28,14', tv: '10759,14' }, // Adventure, Action, Fantasy\n  chill: { movie: '99,36,10770', tv: '99,10764' }, // Documentary, History, Reality\n};\n\nexport async function discoverByMood(mood, mediaType = 'movie') {\n  const genreStr = MOOD_GENRES[mood]?.[mediaType] || MOOD_GENRES.light[mediaType];\n  const endpoint = mediaType === 'movie' ? '/discover/movie' : '/discover/tv';\n  const data = await tmdb(endpoint, `&with_genres=${genreStr}&sort_by=vote_average.desc&vote_count.gte=200&page=${Math.floor(Math.random() * 3) + 1}`);\n  return data.results || [];\n}\n\n// ─── Smart Recommendations (based on library) ───\n\nexport async function getSmartRecommendations(libraryItems) {\n  if (!libraryItems || libraryItems.length === 0) return [];\n\n  // Find highest-rated finished items (prefer user_rating, fallback to external)\n  const rated = libraryItems\n    .filter(i => i.status === 'finished' && i.media_type !== 'book')\n    .sort((a, b) => (b.user_rating || b.external_rating || 0) - (a.user_rating || a.external_rating || 0))\n    .slice(0, 5);\n\n  // Also include items being watched\n  const watching = libraryItems\n    .filter(i => i.status === 'watching' && i.media_type !== 'book')\n    .slice(0, 3);\n\n  const seeds = [...rated, ...watching].slice(0, 6);\n  if (seeds.length === 0) return [];\n\n  // Fetch TMDB recommendations for each seed\n  const allRecs = await Promise.all(\n    seeds.map(async (item) => {\n      try {\n        const endpoint = item.media_type === 'tv' ? `/tv/${item.tmdb_id}` : `/movie/${item.tmdb_id}`;\n        const data = await tmdb(endpoint, '&append_to_response=recommendations');\n        return (data.recommendations?.results || []).map(r => ({\n          ...r,\n          media_type: r.media_type || item.media_type,\n          _source: item.title,\n          _sourceRating: item.user_rating || item.external_rating || 0,\n        }));\n      } catch { return []; }\n    })\n  );\n\n  // Flatten, deduplicate, remove items already in library\n  const libraryIds = new Set(libraryItems.map(i => String(i.tmdb_id)));\n  const seen = new Set();\n  const unique = allRecs.flat().filter(r => {\n    const key = `${r.media_type}-${r.id}`;\n    if (seen.has(key) || libraryIds.has(String(r.id))) return false;\n    seen.add(key);\n    return true;\n  });\n\n  // Score: TMDB rating + bonus for coming from highly-rated seeds\n  unique.sort((a, b) => {\n    const scoreA = (a.vote_average || 0) + (a._sourceRating / 10);\n    const scoreB = (b.vote_average || 0) + (b._sourceRating / 10);\n    return scoreB - scoreA;\n  });\n\n  return unique.slice(0, 20);\n}\n\n// ═══════════════════════════════════════════════════════\n//  SOCIAL: Profiles, Follows, Activity, Blends\n// ═══════════════════════════════════════════════════════\n\n// Preset avatar options — diverse styles via DiceBear API\nexport const AVATAR_PRESETS = {\n  'Adventurer': [\n    'Neo', 'Trinity', 'Ripley', 'Goku', 'Totoro', 'Yoda',\n    'Athena', 'Zephyr', 'Cosmo', 'Pixel', 'Blaze', 'Orbit',\n  ].map(s => `https://api.dicebear.com/9.x/adventurer/svg?seed=${s}`),\n\n  'Portraits': [\n    'Sora', 'Luna', 'Kai', 'Ember', 'Storm', 'Phoenix',\n    'Aurora', 'Vesper', 'Cleo', 'Nyx', 'Zenith', 'Opal',\n  ].map(s => `https://api.dicebear.com/9.x/lorelei/svg?seed=${s}`),\n\n  'Personas': [\n    'Hero', 'Villain', 'Sage', 'Rebel', 'Ghost', 'Ninja',\n    'Druid', 'Rogue', 'Titan', 'Oracle', 'Drift', 'Hex',\n  ].map(s => `https://api.dicebear.com/9.x/personas/svg?seed=${s}`),\n\n  'Minimal': [\n    'Ace', 'Maverick', 'Raven', 'Atlas', 'Echo', 'Cipher',\n    'Nova', 'Flux', 'Prism', 'Quasar', 'Onyx', 'Aero',\n  ].map(s => `https://api.dicebear.com/9.x/notionists/svg?seed=${s}`),\n\n  'Pixel Art': [\n    'Mario', 'Zelda', 'Link', 'Samus', 'Kirby', 'Fox',\n    'Pikachu', 'Cloud', 'Sonic', 'Megaman', 'Pac', 'Snake',\n  ].map(s => `https://api.dicebear.com/9.x/pixel-art/svg?seed=${s}`),\n\n  'Big Smile': [\n    'Joy', 'Sunny', 'Breeze', 'Coral', 'Daisy', 'Mint',\n    'Fern', 'Copper', 'Sienna', 'Jade', 'Willow', 'Ivy',\n  ].map(s => `https://api.dicebear.com/9.x/big-smile/svg?seed=${s}`),\n\n  'Fun Emoji': [\n    'Happy', 'Cool', 'Chill', 'Zen', 'Fire', 'Sparkle',\n    'Wave', 'Star', 'Moon', 'Rain', 'Snow', 'Thunder',\n  ].map(s => `https://api.dicebear.com/9.x/fun-emoji/svg?seed=${s}`),\n\n  'Thumbs': [\n    'Alpha', 'Bravo', 'Charlie', 'Delta', 'Echo', 'Foxtrot',\n    'Golf', 'Hotel', 'India', 'Juliet', 'Kilo', 'Lima',\n  ].map(s => `https://api.dicebear.com/9.x/thumbs/svg?seed=${s}`),\n\n  'Bottts': [\n    'Robo1', 'Mech', 'Droid', 'Bolt', 'Gear', 'Chip',\n    'Wire', 'Core', 'Node', 'Byte', 'Data', 'Grid',\n  ].map(s => `https://api.dicebear.com/9.x/bottts/svg?seed=${s}`),\n\n  'Shapes': [\n    'Ruby', 'Emerald', 'Sapphire', 'Diamond', 'Topaz', 'Amethyst',\n    'Pearl', 'Garnet', 'Citrine', 'Peridot', 'Tanzanite', 'Aqua',\n  ].map(s => `https://api.dicebear.com/9.x/shapes/svg?seed=${s}`),\n};\n\n// ─── Profiles ───\n\nexport async function getProfile(userId) {\n  const { data } = await supabase.from('profiles').select('*').eq('id', userId).maybeSingle();\n  return data;\n}\n\nexport async function getMyProfile() {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return null;\n  const { data } = await supabase.from('profiles').select('*').eq('id', user.id).maybeSingle();\n  if (data) return data;\n  // Auto-create profile row if it doesn't exist yet\n  const username = user.user_metadata?.username || user.email?.split('@')[0] || 'user';\n  const { data: created, error } = await supabase.from('profiles')\n    .upsert({ id: user.id, username }, { onConflict: 'id' })\n    .select()\n    .single();\n  if (error) { console.error('Auto-create profile failed:', error); return null; }\n  return created;\n}\n\nexport async function updateProfile(updates) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  const { data, error } = await supabase.from('profiles')\n    .upsert({ id: user.id, ...updates, updated_at: new Date().toISOString() }, { onConflict: 'id' })\n    .select()\n    .single();\n  if (error) throw error;\n  return data;\n}\n\nexport async function searchUsers(query) {\n  const { data: { user } } = await supabase.auth.getUser();\n  const { data } = await supabase.from('profiles')\n    .select('*')\n    .ilike('username', `%${query}%`)\n    .limit(20);\n  return (data || []).filter(p => p.id !== user?.id);\n}\n\n// ─── Follows ───\n\nexport async function followUser(followingId) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  const { error } = await supabase.from('follows')\n    .insert({ follower_id: user.id, following_id: followingId });\n  if (error) throw error;\n\n  // Log activity\n  const target = await getProfile(followingId);\n  await logActivity({\n    action: 'followed',\n    title: target?.username || 'someone',\n  });\n}\n\nexport async function unfollowUser(followingId) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('Not logged in');\n  const { error } = await supabase.from('follows')\n    .delete()\n    .eq('follower_id', user.id)\n    .eq('following_id', followingId);\n  if (error) throw error;\n}\n\nexport async function getFollowing(userId) {\n  const { data } = await supabase.from('follows')\n    .select('following_id, profiles!follows_following_id_fkey(*)')\n    .eq('follower_id', userId);\n  return (data || []).map(d => d.profiles).filter(Boolean);\n}\n\nexport async function getFollowers(userId) {\n  const { data } = await supabase.from('follows')\n    .select('follower_id, profiles!follows_follower_id_fkey(*)')\n    .eq('following_id', userId);\n  return (data || []).map(d => d.profiles).filter(Boolean);\n}\n\nexport async function isFollowing(followingId) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return false;\n  const { data } = await supabase.from('follows')\n    .select('id')\n    .eq('follower_id', user.id)\n    .eq('following_id', followingId)\n    .maybeSingle();\n  return !!data;\n}\n\n// ─── Activity Feed ───\n\nexport async function logActivity(entry) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return;\n  await supabase.from('activity').insert({ user_id: user.id, ...entry }).select();\n}\n\nexport async function getFriendActivity(limit = 50) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return [];\n  // Get who I follow\n  const { data: follows } = await supabase.from('follows')\n    .select('following_id')\n    .eq('follower_id', user.id);\n  const followingIds = (follows || []).map(f => f.following_id);\n  if (followingIds.length === 0) return [];\n  // Get their activity\n  const { data } = await supabase.from('activity')\n    .select('*, profiles!activity_user_id_fkey(username, avatar_url)')\n    .in('user_id', followingIds)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n  return data || [];\n}\n\nexport async function getMyActivity(limit = 20) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return [];\n  const { data } = await supabase.from('activity')\n    .select('*')\n    .eq('user_id', user.id)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n  return data || [];\n}\n\n// ─── Blends (Spotify-style: shared taste between two users) ───\n\nexport async function getBlend(friendId) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return null;\n\n  // Get both libraries\n  const [myLib, friendLib] = await Promise.all([\n    supabase.from('library').select('*').eq('user_id', user.id).then(r => r.data || []),\n    supabase.from('library').select('*').eq('user_id', friendId).then(r => r.data || []),\n  ]);\n\n  // Find shared items\n  const myIds = new Set(myLib.map(i => i.tmdb_id || i.openlibrary_key).filter(Boolean));\n  const shared = friendLib.filter(i => myIds.has(i.tmdb_id || i.openlibrary_key));\n\n  // Score overlap by genre\n  const myGenres = {};\n  myLib.forEach(i => (i.genres || '').split(',').forEach(g => {\n    const t = g.trim();\n    if (t) myGenres[t] = (myGenres[t] || 0) + 1;\n  }));\n  const friendGenres = {};\n  friendLib.forEach(i => (i.genres || '').split(',').forEach(g => {\n    const t = g.trim();\n    if (t) friendGenres[t] = (friendGenres[t] || 0) + 1;\n  }));\n\n  // Shared genres sorted by overlap\n  const sharedGenres = Object.keys(myGenres)\n    .filter(g => friendGenres[g])\n    .map(g => ({ genre: g, overlap: Math.min(myGenres[g], friendGenres[g]) }))\n    .sort((a, b) => b.overlap - a.overlap)\n    .slice(0, 5);\n\n  // Compatibility score (0-100)\n  const totalPossible = Math.max(myLib.length, friendLib.length, 1);\n  const compatibility = Math.min(100, Math.round((shared.length / totalPossible) * 100 + sharedGenres.length * 5));\n\n  // Generate recommendations based on shared genres\n  let blendRecs = [];\n  if (sharedGenres.length > 0) {\n    const topGenre = sharedGenres[0].genre;\n    // Try to find the TMDB genre ID\n    const genreMap = { 'Action': 28, 'Comedy': 35, 'Drama': 18, 'Horror': 27, 'Romance': 10749, 'Thriller': 53, 'Sci-Fi': 878, 'Animation': 16, 'Crime': 80, 'Documentary': 99, 'Adventure': 12, 'Fantasy': 14, 'Mystery': 9648, 'Science Fiction': 878 };\n    const genreId = genreMap[topGenre];\n    if (genreId) {\n      const recs = await getMoviesByGenre(genreId);\n      const bothIds = new Set([...myLib, ...friendLib].map(i => i.tmdb_id).filter(Boolean));\n      blendRecs = recs.filter(r => !bothIds.has(r.id)).slice(0, 10);\n    }\n  }\n\n  return {\n    shared,\n    sharedGenres,\n    compatibility,\n    blendRecs,\n    myCount: myLib.length,\n    friendCount: friendLib.length,\n  };\n}\n\n// ─── Discover Weekly (personalized recs refreshed weekly) ───\n\nexport async function getDiscoverWeekly() {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return [];\n\n  const library = await getLibrary();\n  if (library.length < 3) return [];\n\n  // Use top-rated + recently added as seeds\n  const seeds = [...library]\n    .sort((a, b) => (b.user_rating || b.external_rating || 0) - (a.user_rating || a.external_rating || 0))\n    .slice(0, 5)\n    .filter(i => i.tmdb_id);\n\n  if (seeds.length === 0) return [];\n\n  // Fetch recs from TMDB for each seed\n  const allRecs = await Promise.all(\n    seeds.map(async (seed) => {\n      try {\n        const mt = seed.media_type === 'tv' ? 'tv' : 'movie';\n        const data = await tmdb(`/${mt}/${seed.tmdb_id}/recommendations`);\n        return (data.results || []).map(r => ({ ...r, media_type: mt }));\n      } catch { return []; }\n    })\n  );\n\n  // Deduplicate & remove existing library items\n  const libIds = new Set(library.map(i => String(i.tmdb_id)));\n  const seen = new Set();\n  const unique = allRecs.flat().filter(r => {\n    const key = `${r.media_type}-${r.id}`;\n    if (seen.has(key) || libIds.has(String(r.id))) return false;\n    seen.add(key);\n    return true;\n  });\n\n  // Score and sort\n  unique.sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0));\n\n  return unique.slice(0, 20);\n}\n\n// ─── Friend's Library (public view) ───\n\nexport async function getFriendLibrary(userId) {\n  const { data } = await supabase.from('library')\n    .select('*')\n    .eq('user_id', userId)\n    .order('added_at', { ascending: false });\n  return data || [];\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z',\n      key: 'r04s7s',\n    },\n  ],\n];\n\n/**\n * @component @name Star\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTEuNTI1IDIuMjk1YS41My41MyAwIDAgMSAuOTUgMGwyLjMxIDQuNjc5YTIuMTIzIDIuMTIzIDAgMCAwIDEuNTk1IDEuMTZsNS4xNjYuNzU2YS41My41MyAwIDAgMSAuMjk0LjkwNGwtMy43MzYgMy42MzhhMi4xMjMgMi4xMjMgMCAwIDAtLjYxMSAxLjg3OGwuODgyIDUuMTRhLjUzLjUzIDAgMCAxLS43NzEuNTZsLTQuNjE4LTIuNDI4YTIuMTIyIDIuMTIyIDAgMCAwLTEuOTczIDBMNi4zOTYgMjEuMDFhLjUzLjUzIDAgMCAxLS43Ny0uNTZsLjg4MS01LjEzOWEyLjEyMiAyLjEyMiAwIDAgMC0uNjExLTEuODc5TDIuMTYgOS43OTVhLjUzLjUzIDAgMCAxIC4yOTQtLjkwNmw1LjE2NS0uNzU1YTIuMTIyIDIuMTIyIDAgMCAwIDEuNTk3LTEuMTZ6IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/star\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Star = createLucideIcon('star', __iconNode);\n\nexport default Star;\n"],"names":["GOOGLE_BOOKS_BASE","cleanGBUrl","url","replace","async","searchGoogleBooks","query","maxResults","arguments","length","undefined","res","fetch","concat","encodeURIComponent","ok","Error","status","json","items","map","mapGoogleBook","_unused","item","_v$imageLinks","_v$imageLinks2","_v$imageLinks3","_v$imageLinks4","_v$imageLinks5","v","volumeInfo","rawThumb","imageLinks","thumbnail","smallThumbnail","cover_urls","hires","standard","push","extraLarge","large","medium","filter","Boolean","forEach","cleaned","includes","key","id","title","author","authors","description","poster_path","name","first_publish_date","publishedDate","subjects","categories","rating","averageRating","ratings_count","ratingsCount","want_to_read","currently_reading","already_read","edition_count","media_type","google_id","industry_identifiers","industryIdentifiers","info_link","infoLink","preview_link","previewLink","JUNK_EDITION_PATTERNS","enrichBookWithGoogleCover","book","some","u","gbResults","isbns","identifier","isbn_13","isbn_10","isbn","slice","titleQ","q","candidates","filtered","c","t","p","test","origWords","toLowerCase","split","w","ct","pool","sort","a","b","gb","OL_BASE","OMDB_KEYS","process","_omdbKeyIdx","_exhaustedKeys","Set","getNextOmdbKey","i","idx","has","clear","omdbFetch","params","attempt","data","add","Response","cache","Map","BOOK_CACHE_TTL","cached","fetcher","ttl","entry","get","Date","now","ts","Promise","resolve","then","set","SCORE_STORE_KEY","OMDB_STORE_KEY","_scoreCache","getScoreStore","JSON","parse","localStorage","getItem","_saveScoreStore","setItem","stringify","_unused2","getSyllabusScore","mediaType","_getScoreStore","setSyllabusScore","score","applyStoredScores","store","unified_rating","_omdbCache","getOmdbStore","purged","k","Object","keys","_unused3","_unused4","saveOmdbEntry","_unused5","getOmdbEntry","_getOmdbStore$key","STATIC_DB_KEY","_staticDbLoaded","lastLoad","parseInt","_unused6","db","scoreStore","merged","type","bucket","entries","s","console","log","String","err","warn","message","loadStaticScoreDB","CHART_STORE_KEY","_chartCache","getChartStore","raw","_v","_unused7","_unused8","getCachedChart","chartKey","getChartAge","Infinity","tmdb","endpoint","tmdbCached","getTrendingMovies","d","results","searchMovies","getMovieDetails","getTrendingTV","searchTV","getTVDetails","getTopRatedMovies","getNowPlayingMovies","getMoviesByGenre","genreId","getTopRatedTV","getTVByGenre","getAnime","getAnimationTV","getTop100Movies","genreParam","minVotes","pages","all","seen","flatMap","m","getTop100TV","parseOMDbResponse","ratings","imdb_id","imdbID","Ratings","r","Source","imdb","Value","votes","imdbVotes","rt","metacritic","Director","director","Writer","writer","Awards","awards","BoxOffice","boxOffice","Rated","rated","Country","country","getOMDbRatings","imdbId","storedKey","stored","omdbType","fallbackData","getOMDbByTitle","year","result","computeUnifiedRating","omdbData","malData","isAnime","_omdbData$imdb","scores","parseFloat","isNaN","_omdbData$rt","reduce","toFixed","enrichChart","onProgress","enriched","_objectSpread","needsFetch","total","completed","phase","rateLimited","batch","_item$genre_ids","_item$genres","release_date","first_air_date","original_language","genre_ids","genres","g","omdb","mal","getMALRating","_unused0","setTimeout","_ref","_ref2","_a$unified_rating","_ref3","_ref4","_b$unified_rating","ra","vote_average","_unused9","saveChart","_ref5","overview","_data$data","anime","scored_by","mal_id","_unused1","OL_COVERS","OL_SEARCH_FIELDS","join","mapOLBook","_w$author_name","_w$authors","_w$authors$","coverUrls","work","size","urls","coverId","cover_i","cover_id","Number","cover_edition_key","buildCoverUrls","author_name","first_publish_year","ratings_average","Math","round","want_to_read_count","already_read_count","currently_reading_count","subject","mapSubjectWork","_w$authors2","_w$authors2$","enrichBatch","books","batchSize","getTrendingBooks","works","_unused10","getBooksBySubject","slug","_unused11","searchBooks","docs","_unused12","getBookDetails","workKey","startsWith","volumeId","getGoogleBookDetails","_work$description","_authors$","_ratings$summary","_ratings$summary2","_shelves$counts","_shelves$counts2","_shelves$counts3","_editions$entries","shelves","editions","catch","authorKeys","_a$author","_a$photos","_a$bio","personal_name","photo","photos","bio","value","covers","ed","_ed$isbn_","_ed$isbn_2","_ed$key","olid","uniqueCovers","desc","summary","average","count","counts","_unused13","getTop100Books","_unused14","getBookRecommendations","_unused15","multiSearch","tmdbData","booksRes","getLibrary","filters","user","supabase","auth","getUser","from","select","eq","order","ascending","error","addToLibrary","dupeQuery","tmdb_id","openlibrary_key","existing","insert","user_id","single","updateLibraryItem","updates","update","updated_at","toISOString","maybeSingle","removeFromLibrary","delete","getLibraryItemByMediaId","_ref6","GENRE_MAP","action","comedy","drama","scifi","thriller","romance","horror","animation","documentary","crime","fantasy","family","getCuratedPicks","genre","page","SCENARIO_KEYWORDS","keywords","searchByScenario","trim","sorted","phrase","config","kwIds","kwParam","movies","tv","floor","random","MOOD_GENRES","light","movie","dark","mind","feel","adventure","chill","discoverByMood","mood","_MOOD_GENRES$mood","genreStr","getSmartRecommendations","libraryItems","seeds","user_rating","external_rating","allRecs","_data$recommendations","recommendations","_source","_sourceRating","_unused16","libraryIds","unique","flat","scoreA","AVATAR_PRESETS","getProfile","userId","getMyProfile","_user$user_metadata","_user$email","username","user_metadata","email","created","upsert","onConflict","updateProfile","searchUsers","ilike","limit","followUser","followingId","follower_id","following_id","target","logActivity","unfollowUser","getFollowing","profiles","getFollowers","isFollowing","getFriendActivity","follows","followingIds","f","in","getMyActivity","getBlend","friendId","myLib","friendLib","myIds","shared","myGenres","friendGenres","sharedGenres","overlap","min","totalPossible","max","compatibility","blendRecs","recs","bothIds","myCount","friendCount","getDiscoverWeekly","library","mt","seed","_unused17","libIds","getFriendLibrary","Star","createLucideIcon"],"sourceRoot":""}